<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Your Event | Hibiscus Studio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300;1,9..40,400&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Warm dark — matches main site */
            --bg-base: #141210;
            --bg-surface: #1E1B18;
            --bg-elevated: #252220;
            --text-primary: #F0ECE4;
            --text-secondary: #C4BFB6;
            --text-muted: #6E675E;
            --border-color: #2E2A25;
            --accent: #D4848F;
            --accent-light: #E8A5AE;
            --gradient: linear-gradient(135deg, #2E2A25, #1E1B18);
            --success: #7AA87A;
            --success-soft: rgba(122,168,122,0.15);
            --success-border: rgba(122,168,122,0.3);
            --warning: #C9944A;
            --warning-soft: rgba(201,148,74,0.15);
            --warning-border: rgba(201,148,74,0.35);
            --danger: #C75B5B;
            --danger-soft: rgba(199,91,91,0.15);
            --bg-base-rgb: 20,18,16;
            --font-body: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-display: 'Instrument Serif', Georgia, serif;
        }

        [data-theme="light"] {
            /* Warm cream — matches main site */
            --bg-base: #FEFDFB;
            --bg-surface: #F5F0E8;
            --bg-elevated: #EBE6DD;
            --text-primary: #1C1917;
            --text-secondary: #44403C;
            --text-muted: #A8A29E;
            --border-color: #E8E3DA;
            --accent: #BE4D5E;
            --accent-light: #D4949E;
            --gradient: linear-gradient(135deg, #F5F0E8, #FEFDFB);
            --success: #5E8F5E;
            --success-soft: rgba(94,143,94,0.12);
            --success-border: rgba(94,143,94,0.25);
            --warning: #A67B3D;
            --warning-soft: rgba(166,123,61,0.12);
            --warning-border: rgba(166,123,61,0.3);
            --danger: #B54A4A;
            --danger-soft: rgba(181,74,74,0.12);
            --bg-base-rgb: 254,253,251;
            --font-body: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-display: 'Instrument Serif', Georgia, serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: var(--font-body);
            background: var(--bg-base);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 120px;
            transition: background 0.3s, color 0.3s;
            background-image:
                linear-gradient(rgba(120,110,100,0.04) 1px, transparent 1px),
                linear-gradient(to right, rgba(120,110,100,0.04) 1px, transparent 1px);
            background-size: 40px 40px;
        }
        .header {
            text-align: center;
            margin-bottom: 16px;
            position: relative;
            z-index: 2;
            padding: 12px 0 8px;
            background: linear-gradient(to bottom, var(--bg-surface), transparent);
            border-radius: 0 0 24px 24px;
            margin: -20px -20px 16px;
            padding-left: 20px;
            padding-right: 20px;
        }
        .theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            width: 36px;
            height: 36px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .theme-toggle:hover {
            border-color: var(--accent);
            color: var(--text-primary);
        }
        [data-theme="light"] .t-light { display: none; }
        [data-theme="light"] .t-dark { display: block; }
        .t-dark { display: none; }
        [data-theme="dark"] .t-dark { display: block; color: #E8C547; }
        [data-theme="dark"] .t-light { display: none; }
        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 8px;
        }
        .header-decor {
            width: 60px;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border-color));
        }
        .header-decor.right {
            background: linear-gradient(90deg, var(--border-color), transparent);
        }
        .brand-mark {
            font-family: var(--font-display);
            font-size: 1.6rem;
            font-weight: 400;
            letter-spacing: 0.02em;
            color: var(--text-primary);
            cursor: pointer;
            transition: color 0.2s;
        }
        .brand-mark:hover {
            color: var(--accent);
        }
        .header-sub {
            font-size: 0.6rem;
            font-weight: 600;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.16em;
            text-align: center;
            margin-top: 6px;
        }
        .step-title {
            font-family: var(--font-display);
            font-style: italic;
        }
        .choice-card .title {
            font-family: var(--font-display);
        }

        /* Decorative flower pattern - heavy spaced */
        .flower-pattern {
            position: fixed;
            pointer-events: none;
            z-index: 0;
            display: flex;
            flex-direction: column;
            gap: 40px;
            padding: 60px 0;
        }
        .flower-pattern.left {
            left: 30px;
            top: 0;
            bottom: 0;
            align-items: flex-start;
        }
        .flower-pattern.right {
            right: 30px;
            top: 0;
            bottom: 0;
            align-items: flex-end;
        }
        .flower-pattern img {
            width: 140px;
            height: auto;
            opacity: 0.35;
            transition: opacity 0.3s;
        }
        .flower-pattern.left img {
            transform: scaleX(-1);
        }
        .flower-pattern.left img:nth-child(even) {
            transform: scaleX(-1) rotate(25deg);
            margin-left: 30px;
        }
        .flower-pattern.right img:nth-child(even) {
            transform: rotate(-25deg);
            margin-right: 30px;
        }
        .flower-pattern img:nth-child(3n) {
            opacity: 0.25;
            width: 100px;
        }
        /* Light mode: sepia/warm filter for cream aesthetic */
        [data-theme="light"] .flower-pattern img {
            opacity: 0.22;
            filter: sepia(30%) brightness(0.85);
        }
        [data-theme="light"] .flower-pattern img:nth-child(3n) {
            opacity: 0.15;
        }
        /* Tablet: smaller, closer to edges */
        @media (max-width: 1100px) {
            .flower-pattern {
                gap: 60px;
            }
            .flower-pattern.left {
                left: 10px;
            }
            .flower-pattern.right {
                right: 10px;
            }
            .flower-pattern img {
                width: 80px;
                opacity: 0.20;
            }
            .flower-pattern img:nth-child(3n) {
                width: 60px;
                opacity: 0.12;
            }
        }
        /* Mobile: BOLD corner accents - first impression matters */
        @media (max-width: 768px) {
            .flower-pattern {
                gap: 0;
                padding: 0;
            }
            .flower-pattern.left {
                left: -15px;
                top: 50px;
                bottom: auto;
            }
            .flower-pattern.right {
                right: -15px;
                top: auto;
                bottom: 80px;
            }
            .flower-pattern img {
                display: none;
            }
            /* Top-left cluster */
            .flower-pattern.left img:first-child {
                display: block;
                width: 130px;
                opacity: 0.45;
                transform: scaleX(-1) rotate(-15deg);
            }
            .flower-pattern.left img:nth-child(2) {
                display: block;
                width: 90px;
                opacity: 0.35;
                transform: scaleX(-1) rotate(20deg);
                margin-top: 10px;
                margin-left: 50px;
            }
            .flower-pattern.left img:nth-child(3) {
                display: block;
                width: 60px;
                opacity: 0.25;
                transform: scaleX(-1) rotate(-30deg);
                margin-top: 5px;
                margin-left: 20px;
            }
            /* Bottom-right cluster */
            .flower-pattern.right img:first-child {
                display: block;
                width: 140px;
                opacity: 0.50;
                transform: rotate(10deg);
            }
            .flower-pattern.right img:nth-child(2) {
                display: block;
                width: 85px;
                opacity: 0.35;
                transform: rotate(-20deg);
                margin-bottom: 10px;
                margin-right: 55px;
            }
            .flower-pattern.right img:nth-child(3) {
                display: block;
                width: 55px;
                opacity: 0.25;
                transform: rotate(25deg);
                margin-bottom: 5px;
                margin-right: 25px;
            }
        }
        /* Small phones: scaled down but still bold */
        @media (max-width: 400px) {
            .flower-pattern.left {
                left: -25px;
                top: 45px;
            }
            .flower-pattern.right {
                right: -25px;
                bottom: 60px;
            }
            .flower-pattern.left img:first-child {
                width: 110px;
                opacity: 0.40;
            }
            .flower-pattern.left img:nth-child(2) {
                width: 70px;
                opacity: 0.30;
            }
            .flower-pattern.left img:nth-child(3) {
                width: 45px;
            }
            .flower-pattern.right img:first-child {
                width: 115px;
                opacity: 0.45;
            }
            .flower-pattern.right img:nth-child(2) {
                width: 65px;
                opacity: 0.30;
            }
            .flower-pattern.right img:nth-child(3) {
                width: 40px;
            }
        }
        /* Light mode mobile: warmer, softer flowers */
        @media (max-width: 768px) {
            [data-theme="light"] .flower-pattern img {
                filter: sepia(40%) brightness(0.75) contrast(0.9);
            }
            [data-theme="light"] .flower-pattern.left img:first-child {
                opacity: 0.35;
            }
            [data-theme="light"] .flower-pattern.right img:first-child {
                opacity: 0.40;
            }
        }


        /* Steps */
        .step {
            display: none;
            animation: fadeIn 0.3s ease;
            position: relative;
            z-index: 1;
        }
        .step.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Welcome hero (step 1 landing) */
        .welcome-hero {
            text-align: center;
            max-width: 420px;
            margin: 0 auto 20px;
        }
        .welcome-subtitle {
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 12px;
        }
        .welcome-title {
            font-family: var(--font-display);
            font-style: italic;
            font-size: clamp(1.8rem, 6vw, 2.4rem);
            font-weight: 400;
            color: var(--text-primary);
            line-height: 1.15;
            margin-bottom: 10px;
        }
        .welcome-desc {
            font-size: 0.9rem;
            font-weight: 300;
            color: var(--text-secondary);
            line-height: 1.5;
            letter-spacing: 0.01em;
        }

        /* Compact choices for above-the-fold */
        .choices-compact .choice-card {
            padding: 18px 20px;
        }
        .choices-compact .choice-card .title {
            font-size: 1.1rem;
            margin-bottom: 2px;
        }
        .choices-compact .choice-card .desc {
            font-size: 0.82rem;
        }
        .choices-compact {
            gap: 10px;
        }

        /* Review snippet */
        .review-snippet {
            max-width: 420px;
            margin: 24px auto 0;
            text-align: center;
            padding: 18px 20px;
            background: var(--bg-surface);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }
        .review-stars {
            color: var(--accent);
            font-size: 0.85rem;
            letter-spacing: 2px;
            margin-bottom: 8px;
        }
        .review-text {
            font-family: var(--font-display);
            font-style: italic;
            font-size: 0.95rem;
            color: var(--text-primary);
            line-height: 1.5;
            margin-bottom: 8px;
        }
        .review-author {
            font-size: 0.7rem;
            font-weight: 500;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        /* Minimal header for deep funnel */
        .header-minimal {
            text-align: center;
        }
        .brand-mark-small {
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-weight: 400;
            color: var(--text-muted);
            cursor: pointer;
            transition: color 0.2s;
        }
        .brand-mark-small:hover {
            color: var(--accent);
        }

        .step-title {
            font-family: var(--font-display);
            font-style: italic;
            font-size: 1.6rem;
            font-weight: 400;
            color: var(--text-primary);
            margin-bottom: 28px;
            text-align: center;
            line-height: 1.3;
        }
        .step-number {
            display: block;
            font-family: var(--font-body);
            font-style: normal;
            font-size: 0.6rem;
            font-weight: 600;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 8px;
        }

        /* Choice cards */
        .choices {
            display: flex;
            flex-direction: column;
            gap: 14px;
            max-width: 420px;
            margin: 0 auto;
        }
        .choice-card {
            background: var(--bg-surface);
            border: 1.5px solid var(--border-color);
            border-radius: 16px;
            padding: 28px 24px 24px;
            cursor: pointer;
            transition: all 0.25s ease;
        }
        .choice-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.04);
        }
        .choice-card:active {
            transform: translateY(0);
        }
        .choice-card.selected {
            border-color: var(--accent);
            background: var(--bg-elevated);
            box-shadow: 0 0 0 1px var(--accent), 0 4px 16px rgba(190,77,94,0.12);
        }
        .viewing-card {
            background: var(--success-soft);
            border: 1.5px solid var(--success-border);
        }
        .viewing-card:hover {
            border-color: var(--success);
            box-shadow: 0 8px 24px rgba(122,168,122,0.12);
        }
        .viewing-card .event-icon {
            background: var(--success);
            color: #fff;
        }
        .free-badge {
            display: inline-block;
            background: var(--success);
            color: #fff;
            font-family: var(--font-body);
            font-size: 0.65rem;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 100px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            vertical-align: middle;
            margin-left: 4px;
        }
        .choice-card .title {
            font-family: var(--font-display);
            font-size: 1.25rem;
            font-weight: 400;
            color: var(--text-primary);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .choice-card .desc {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        .event-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 8px;
            background: var(--bg-elevated);
            font-size: 0.85rem;
            color: var(--accent);
            flex-shrink: 0;
        }
        .choice-card:hover .event-icon {
            background: var(--accent);
            color: #fff;
        }

        /* Date cards */
        .date-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            max-width: 420px;
            margin: 20px auto 0;
        }
        .date-card {
            background: var(--bg-surface);
            border: 1.5px solid var(--border-color);
            border-radius: 16px;
            padding: 22px 16px 18px;
            text-align: center;
            cursor: pointer;
            transition: all 0.25s ease;
        }
        .date-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.04);
        }
        .date-card.selected {
            border-color: var(--accent);
            background: var(--bg-elevated);
            box-shadow: 0 0 0 1px var(--accent);
        }
        .date-card .day-name {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }
        .date-card .day-num {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 400;
            color: var(--text-primary);
            margin: 4px 0;
        }
        .date-card .month {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Step subtitle */
        .step-subtitle {
            font-size: 0.95rem;
            color: var(--text-muted);
            text-align: center;
            margin-top: -12px;
            margin-bottom: 20px;
        }

        /* Duration picker — accordion pattern */
        .duration-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-width: 420px;
            margin: 0 auto;
        }
        .duration-card {
            background: var(--bg-surface);
            border: 1.5px solid var(--border-color);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.22, 1, 0.36, 1);
            position: relative;
            overflow: hidden;
        }
        .duration-card:hover:not(.selected) {
            border-color: var(--text-muted);
            background: var(--bg-elevated);
        }
        .duration-card.selected {
            border-color: var(--success);
            background: var(--bg-elevated);
            box-shadow: 0 0 0 1px var(--success), 0 8px 28px rgba(0,0,0,0.15);
        }
        .duration-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 18px;
            gap: 10px;
        }
        .duration-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .duration-radio {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 1.5px solid var(--border-color);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.25s ease;
        }
        .duration-card.selected .duration-radio {
            border-color: var(--success);
            background: var(--success-soft);
        }
        .duration-radio::after {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            transform: scale(0);
            transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .duration-card.selected .duration-radio::after {
            transform: scale(1);
        }
        .duration-hours {
            font-family: var(--font-display);
            font-size: 1.25rem;
            font-weight: 400;
            color: var(--text-primary);
            line-height: 1;
        }
        .duration-sublabel {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 300;
            margin-top: 1px;
        }
        .duration-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .duration-badge {
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            padding: 3px 8px;
            border-radius: 6px;
            background: var(--success-soft);
            color: var(--success);
            white-space: nowrap;
        }
        .duration-price {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--accent);
            letter-spacing: -0.01em;
        }
        .duration-detail {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }
        .duration-card.selected .duration-detail {
            grid-template-rows: 1fr;
        }
        .duration-detail-inner {
            overflow: hidden;
        }
        .duration-detail-content {
            padding: 0 18px 16px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .duration-detail-divider {
            height: 1px;
            background: var(--border-color);
            margin-bottom: 2px;
        }
        .duration-detail-row {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            font-size: 0.82rem;
            color: var(--text-secondary);
            font-weight: 300;
            line-height: 1.4;
        }
        .duration-detail-row svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
            margin-top: 1px;
            opacity: 0.45;
        }
        .duration-per-hour {
            display: none;
        }
        .duration-card.recommended:not(.selected) {
            border-color: var(--success-border);
        }
        /* Hide price on duration cards — front-load decision, not cost */
        .duration-price {
            display: none !important;
        }

        /* Time slots - ticket style */
        .time-slots {
            display: flex;
            flex-direction: column;
            gap: 14px;
            max-width: 420px;
            margin: 0 auto;
        }
        .time-slot {
            background: var(--bg-surface);
            border: 1.5px solid var(--border-color);
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.25s ease;
        }
        .time-slot:hover {
            border-color: var(--accent);
            box-shadow: 0 4px 16px rgba(0,0,0,0.06);
        }
        .time-slot.selected {
            border-color: var(--accent);
            background: var(--bg-elevated);
            box-shadow: 0 0 0 1px var(--accent);
        }
        .time-slot.unavailable {
            opacity: 0.4;
            pointer-events: none;
            cursor: not-allowed;
            border-color: var(--border-color);
        }
        .time-slot.unavailable:hover {
            border-color: var(--border-color);
        }
        .time-slot-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 22px;
        }
        .time-slot .time-range {
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .time-slot .time {
            font-family: var(--font-display);
            font-size: 1.3rem;
            font-weight: 400;
            color: var(--text-primary);
        }
        .time-slot .arrow {
            color: var(--text-muted);
            font-size: 1.3rem;
        }
        .time-slot .badge {
            background: var(--bg-elevated);
            color: var(--text-secondary);
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 500;
            border: 1px solid var(--border-color);
            white-space: nowrap;
            flex-shrink: 0;
        }
        .time-slot .badge.late {
            background: var(--warning-soft);
            color: var(--warning);
            border-color: var(--warning-border);
        }
        .time-breakdown {
            display: none;
            background: var(--bg-base);
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
        }
        .time-slot.expanded .time-breakdown {
            display: block;
        }

        /* Visual time bar - shows proportions */
        .time-visual {
            display: flex;
            height: 48px;
            border-radius: 10px;
            overflow: hidden;
            background: var(--bg-elevated);
        }
        .time-segment {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            font-weight: 500;
            color: var(--text-muted);
            line-height: 1.2;
            text-align: center;
        }
        .time-segment.setup {
            width: 12.5%;
            background: var(--border-color);
        }
        .time-segment.event {
            width: 75%;
            background: var(--accent);
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--bg-base);
            flex-direction: row;
            letter-spacing: 0.02em;
        }
        .time-segment.packdown {
            width: 12.5%;
            background: var(--border-color);
        }

        /* Comparison examples */
        .compare-section {
            margin-top: 16px;
            text-align: center;
        }
        .compare-main {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        .compare-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 2px;
        }
        .compare-examples {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 12px;
        }
        .compare-example {
            background: var(--bg-elevated);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
        }
        .compare-example .thing {
            color: var(--text-secondary);
        }

        /* Timeline visual for setup/packdown */
        .timeline-visual {
            display: flex;
            align-items: stretch;
            margin: 12px 0 16px;
            padding: 12px;
            background: var(--bg-elevated);
            border-radius: 10px;
            gap: 6px;
        }
        .timeline-segment {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .timeline-segment.setup,
        .timeline-segment.packdown {
            flex: 0 0 60px;
        }
        .timeline-segment.event {
            flex: 1;
        }
        .segment-icon {
            font-size: 1rem;
            margin-bottom: 4px;
        }
        .segment-bar {
            height: 6px;
            border-radius: 3px;
            width: 100%;
            margin-bottom: 6px;
        }
        .timeline-segment.setup .segment-bar,
        .timeline-segment.packdown .segment-bar {
            background: var(--border-color);
        }
        .timeline-segment.event .segment-bar {
            background: var(--accent);
        }
        .segment-label {
            font-size: 0.6rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }
        .segment-time {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        .timeline-segment.event .segment-time {
            color: var(--accent);
            font-weight: 500;
        }

        .breakdown-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 0.8rem;
        }
        .breakdown-row .label {
            color: var(--text-muted);
        }
        .breakdown-row .value {
            color: var(--text-primary);
        }
        .breakdown-row.event-row {
            color: var(--text-primary);
        }
        .breakdown-row.event-row .label,
        .breakdown-row.event-row .value {
            color: var(--text-primary);
            font-weight: 600;
        }
        .expand-hint {
            text-align: center;
            font-size: 0.7rem;
            color: var(--text-muted);
            padding: 8px;
            border-top: 1px solid var(--border-color);
        }
        .time-slot.expanded .expand-hint {
            display: none;
        }
        .select-time-btn {
            display: none;
            background: var(--accent);
            color: #fff;
            border: none;
            padding: 14px;
            width: 100%;
            font-size: 0.9rem;
            font-weight: 600;
            font-family: var(--font-body);
            cursor: pointer;
            transition: filter 0.2s;
        }
        .select-time-btn:hover {
            opacity: 0.88;
        }
        .time-slot.expanded .select-time-btn {
            display: block;
        }

        /* Social proof strip */
        .proof-strip {
            max-width: 420px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px 16px;
            background: var(--bg-surface);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }
        .proof-avatars {
            display: flex;
            align-items: center;
        }
        .proof-avatar {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: var(--accent);
            color: #fff;
            font-size: 0.55rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: -7px;
            border: 2px solid var(--bg-surface);
        }
        .proof-avatar:first-child {
            margin-left: 0;
        }
        .proof-avatar:nth-child(2) { background: var(--success); }
        .proof-avatar:nth-child(3) { background: var(--warning); }
        .proof-text {
            font-size: 0.72rem;
            color: var(--text-muted);
        }
        .proof-text strong {
            color: var(--text-secondary);
        }

        /* Availability indicator */
        .availability-strip {
            max-width: 420px;
            margin: 16px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 14px;
            background: var(--bg-surface);
            border-radius: 8px;
        }
        .avail-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        .avail-text {
            font-size: 0.72rem;
            color: var(--text-muted);
        }

        /* Social proof */
        .social-proof {
            max-width: 420px;
            margin: 24px auto;
            text-align: center;
        }
        .social-proof-img {
            width: 100%;
            height: 200px;
            background: var(--bg-surface);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .social-proof-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .social-proof-caption {
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        .social-proof-caption strong {
            color: var(--text-primary);
        }

        /* Guest selector - 2x2 grid */
        .guest-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            max-width: 420px;
            margin: 0 auto;
        }
        .guest-btn {
            background: var(--bg-surface);
            border: 1.5px solid var(--border-color);
            border-radius: 16px;
            padding: 28px 18px 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.25s ease;
        }
        .guest-btn:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.04);
        }
        .guest-btn.selected {
            border-color: var(--accent);
            background: var(--bg-elevated);
            box-shadow: 0 0 0 1px var(--accent);
        }
        .guest-btn .num {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 400;
            color: var(--text-primary);
        }
        .guest-btn .label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-muted);
            margin-top: 6px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        /* Form fields */
        .form-group {
            margin-bottom: 18px;
            max-width: 420px;
            margin-left: auto;
            margin-right: auto;
            position: relative;
        }
        .form-label {
            display: block;
            color: var(--text-muted);
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            margin-bottom: 10px;
        }
        .form-input {
            width: 100%;
            padding: 14px 16px;
            padding-right: 44px;
            background: var(--bg-base);
            border: 1.5px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: var(--font-body);
            font-size: 0.95rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(190,77,94,0.1);
        }
        .form-input.valid {
            border-color: var(--success);
            box-shadow: 0 0 0 3px rgba(122,168,122,0.1);
        }
        .input-check {
            position: absolute;
            right: 14px;
            top: 36px;
            color: var(--success);
            font-size: 1rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .input-check.show {
            opacity: 1;
        }

        /* Perforation divider */
        .perforation {
            display: flex;
            align-items: center;
            margin: 0 -24px;
            padding: 0;
        }
        .perf-line {
            border-top: 2px dashed var(--border-color);
            flex: 1;
        }
        .perf-circle {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--bg-base);
            border: 1px solid var(--border-color);
            margin: 0 -7px;
            flex-shrink: 0;
            position: relative;
            z-index: 1;
        }
        .perforation.in-summary {
            margin: 0 -24px;
        }

        /* Summary card — ticket style */
        .summary {
            background: var(--bg-surface);
            border-radius: 20px;
            padding: 0;
            max-width: 420px;
            margin: 0 auto;
            overflow: visible;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 20px rgba(0,0,0,0.04);
        }
        .summary-header {
            padding: 22px 24px 16px;
            text-align: center;
        }
        .summary-mark {
            font-size: 0.6rem;
            font-weight: 600;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 8px;
        }
        .summary-title {
            font-family: var(--font-display);
            font-style: italic;
            font-size: 1.3rem;
            color: var(--text-primary);
        }
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 14px 24px;
            border-bottom: 1px solid var(--border-color);
        }
        .summary-row:last-child {
            border-bottom: none;
        }
        .summary-label {
            color: var(--text-muted);
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            align-self: center;
        }
        .summary-value {
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.95rem;
            text-align: right;
            flex: 1;
        }
        .summary-edit {
            color: var(--text-muted);
            font-size: 0.75rem;
            margin-left: 10px;
            opacity: 0.5;
            transition: opacity 0.2s;
            align-self: center;
        }
        .summary-row:hover .summary-edit {
            opacity: 1;
            color: var(--accent);
        }

        /* Event comparison banner - replaces countdown */
        .event-vibe {
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 18px;
            max-width: 420px;
            margin-left: auto;
            margin-right: auto;
        }
        .event-vibe .vibe-header {
            text-align: center;
            margin-bottom: 14px;
        }
        .event-vibe .vibe-time {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        .event-vibe .vibe-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 3px;
        }
        .event-vibe .vibe-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .event-vibe .vibe-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-muted);
            padding: 8px 12px;
            background: var(--bg-base);
            border-radius: 6px;
        }
        .event-vibe .vibe-item .thing {
            color: var(--text-secondary);
        }

        /* FAQ section */
        .faq {
            max-width: 420px;
            margin: 24px auto;
        }
        .faq-title {
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            margin-bottom: 14px;
        }
        .faq-item {
            background: var(--bg-surface);
            border-radius: 12px;
            padding: 18px 22px;
            margin-bottom: 12px;
        }
        .faq-q {
            font-size: 1rem;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        .faq-a {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Deposit info */
        .deposit-info {
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px 24px;
            max-width: 420px;
            margin: 18px auto;
            position: relative;
        }
        .deposit-info .main {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .deposit-info .label {
            color: var(--success);
            font-size: 0.85rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }
        .deposit-info .amount {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 400;
            color: var(--text-primary);
        }
        .deposit-info .note {
            font-size: 0.82rem;
            color: var(--success);
            margin-top: 10px;
            line-height: 1.5;
        }

        /* Buttons */
        .btn {
            display: block;
            width: 100%;
            max-width: 420px;
            margin: 24px auto 0;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary {
            background: var(--accent);
            color: #fff;
            position: relative;
            overflow: hidden;
            border-radius: 100px;
        }
        .btn-primary:hover {
            opacity: 0.88;
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(190,77,94,0.25);
        }
        .btn-primary:disabled {
            background: var(--border-color);
            color: var(--text-muted);
            cursor: not-allowed;
            opacity: 0.5;
        }
        .btn-secondary {
            background: rgba(var(--bg-base-rgb, 20,18,16), 0.75);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            position: fixed;
            bottom: 32px;
            left: 20px;
            right: 20px;
            width: auto;
            max-width: 420px;
            margin: 0 auto;
            padding: 16px;
            font-size: 0.95rem;
            border-radius: 100px;
            z-index: 40;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
        }
        .btn-secondary:hover {
            border-color: var(--accent);
            color: var(--text-primary);
        }
        .btn-ghost {
            background: transparent;
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-top: 8px;
        }

        /* Sticky footer bar for steps with back + continue */
        .sticky-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 40;
            padding: 16px 20px 32px;
            background: linear-gradient(to top, var(--bg-base) 70%, transparent);
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .sticky-footer .btn-back {
            flex: 0 0 auto;
            background: rgba(var(--bg-base-rgb, 20,18,16), 0.75);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 16px 20px;
            font-size: 0.95rem;
            border-radius: 100px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: var(--font-body);
            font-weight: 600;
        }
        .sticky-footer .btn-back:hover {
            border-color: var(--accent);
            color: var(--text-primary);
        }
        .sticky-footer .btn-continue {
            flex: 1;
            max-width: 300px;
            background: var(--accent);
            color: #fff;
            border: none;
            padding: 16px 24px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 100px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: var(--font-body);
        }
        .sticky-footer .btn-continue:hover {
            opacity: 0.88;
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(190,77,94,0.25);
        }

        /* Confirmation */
        .confirmation {
            text-align: center;
            padding: 60px 20px 40px;
        }
        .confirm-icon {
            width: 88px;
            height: 88px;
            background: var(--success);
            border-radius: 50%;
            margin: 0 auto 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: #fff;
            animation: confirmPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) both;
            box-shadow: 0 8px 32px rgba(122,168,122,0.3);
        }
        @keyframes confirmPop {
            0% { transform: scale(0); opacity: 0; }
            60% { transform: scale(1.15); }
            100% { transform: scale(1); opacity: 1; }
        }
        .confirm-title {
            font-family: var(--font-display);
            font-style: italic;
            font-size: 1.8rem;
            font-weight: 400;
            color: var(--text-primary);
            margin-bottom: 12px;
        }
        .confirm-text {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.7;
            max-width: 320px;
            margin: 0 auto;
        }

        /* Progress stepper */
        .progress-bar {
            max-width: 420px;
            margin: 20px auto 28px;
            background: var(--border-color);
            border-radius: 100px;
            height: 3px;
            overflow: hidden;
            position: relative;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent-light));
            border-radius: 100px;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .progress-label {
            max-width: 420px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            padding: 0 4px;
        }
        .progress-label span {
            font-size: 0.55rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-muted);
            transition: color 0.3s;
        }
        .progress-label span.active {
            color: var(--accent);
        }

        /* Viewing option */
        .viewing-link {
            text-align: center;
            margin-top: 28px;
            padding-top: 28px;
            border-top: 1px solid var(--border-color);
            max-width: 420px;
            margin-left: auto;
            margin-right: auto;
        }
        .viewing-link a {
            color: var(--text-muted);
            font-size: 0.95rem;
            text-decoration: none;
        }
        .viewing-link a:hover {
            color: var(--text-primary);
        }

        /* Viewing step */
        .viewing-info {
            background: var(--bg-surface);
            border-radius: 16px;
            padding: 24px;
            max-width: 420px;
            margin: 0 auto 24px;
            text-align: center;
        }
        .viewing-info .icon {
            font-size: 2.2rem;
            margin-bottom: 14px;
        }
        .viewing-info .title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }
        .viewing-info .desc {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        /* Month picker */
        .month-picker {
            max-width: 420px;
            margin: 0 auto;
        }
        .month-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .month-nav-btn {
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s;
        }
        .month-nav-btn:hover {
            border-color: var(--accent);
            color: var(--text-primary);
        }
        .month-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        .month-display {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .month-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        .month-btn {
            background: var(--bg-surface);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 18px 14px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .month-btn:hover {
            border-color: var(--accent);
        }
        .month-btn.selected {
            border-color: var(--accent);
            background: var(--bg-elevated);
        }
        .month-btn .month-name {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .month-btn .month-year {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Visual amenities */
        .amenities-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 16px 0;
        }
        .amenity-item {
            background: var(--bg-surface);
            border-radius: 10px;
            padding: 12px 8px;
            text-align: center;
        }
        .amenity-item .icon {
            font-size: 1rem;
            margin-bottom: 4px;
            opacity: 0.5;
            color: var(--text-muted);
        }
        .amenity-item .label {
            font-size: 0.65rem;
            color: var(--text-muted);
            line-height: 1.2;
        }

        /* Optional extras */
        .extras-section {
            max-width: 420px;
            margin: 24px auto;
        }
        .extras-title {
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .extras-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border-color);
        }
        .extra-option {
            background: var(--bg-base);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 12px 16px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .extra-option:hover {
            background: var(--bg-surface);
            border-color: var(--text-muted);
        }
        .extra-option.selected {
            border-color: var(--accent);
            background: var(--bg-surface);
        }
        .extra-info {
            flex: 1;
        }
        .extra-info .name {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-weight: 500;
        }
        .extra-info .desc {
            display: none;
        }
        .extra-price {
            color: var(--text-muted);
            font-weight: 500;
            font-size: 0.75rem;
        }
        .extra-option.selected .extra-price {
            color: var(--text-primary);
        }
        .extra-option.selected .extra-info .name {
            color: var(--text-secondary);
        }
        .extra-check {
            width: 20px;
            height: 20px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-left: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: transparent;
            font-size: 0.7rem;
            transition: all 0.2s;
        }
        .extra-option.selected .extra-check {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-base);
        }

        /* Time breakdown visual emphasis */
        .breakdown-row.event {
            background: var(--bg-elevated);
            margin: 8px -20px;
            padding: 12px 20px;
            border-left: 3px solid var(--accent);
            position: relative;
        }
        .breakdown-row.event .label {
            font-size: 0.85rem;
        }
        .breakdown-row.event .value {
            font-size: 0.85rem;
        }
    </style>

    <!-- Cloudflare Turnstile (invisible bot protection) -->
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body>
    <!-- Decorative flower pattern (sides) -->
    <div class="flower-pattern left" aria-hidden="true">
        <img src="../assets/hibiscus-flower.png" alt="">
        <img src="../assets/hibiscus-flower.png" alt="">
        <img src="../assets/hibiscus-flower.png" alt="">
        <img src="../assets/hibiscus-flower.png" alt="">
        <img src="../assets/hibiscus-flower.png" alt="">
        <img src="../assets/hibiscus-flower.png" alt="">
        <img src="../assets/hibiscus-flower.png" alt="">
        <img src="../assets/hibiscus-flower.png" alt="">
    </div>
    <div class="flower-pattern right" aria-hidden="true">
        <img src="../assets/hibiscus-flower.png" alt="">
        <img src="../assets/hibiscus-flower.png" alt="">
        <img src="../assets/hibiscus-flower.png" alt="">
        <img src="../assets/hibiscus-flower.png" alt="">
        <img src="../assets/hibiscus-flower.png" alt="">
        <img src="../assets/hibiscus-flower.png" alt="">
        <img src="../assets/hibiscus-flower.png" alt="">
        <img src="../assets/hibiscus-flower.png" alt="">
    </div>

    <div class="header" id="mainHeader">
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark mode">
            <span class="t-light"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></span>
            <span class="t-dark"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span>
        </button>
        <!-- Minimal header for all steps -->
        <div class="header-minimal" id="headerMinimal" style="display:none;">
            <span class="brand-mark-small" onclick="startOver()" title="Start over">Hibiscus Studio</span>
        </div>
    </div>

    <div class="progress-label" id="progressLabels" style="display:none;">
        <span class="active">Event</span>
        <span>When</span>
        <span>Time</span>
        <span>Details</span>
    </div>
    <div class="progress-bar" id="progressBar" style="display:none;">
        <div class="progress-fill" id="progressFill" style="width: 12.5%"></div>
    </div>

    <!-- Step 0: Viewing or Booking -->
    <div class="step active" id="step0">
        <div class="welcome-hero">
            <h1 class="welcome-title">Book your perfect event</h1>
            <p class="welcome-desc">A blank canvas space in Canning Town — yours to make your own.</p>
        </div>

        <div class="choices" style="max-width:420px; margin:0 auto; gap:12px;">
            <div class="choice-card viewing-card" onclick="goToViewing()" style="text-align:center;">
                <div class="title" style="justify-content:center;"><span class="event-icon viewing">◎</span> View the space <span class="free-badge">FREE</span></div>
                <div class="desc">20 min tour · no commitment</div>
            </div>
            <div class="choice-card" onclick="goToEventTypes()" style="text-align:center;">
                <div class="title" style="justify-content:center;"><span class="event-icon">→</span> Book an event</div>
                <div class="desc">Bridal, private events, workshops, content shoots</div>
            </div>
        </div>

        <!-- Review snippet — visible immediately -->
        <div class="review-snippet">
            <div class="review-stars">★★★★★</div>
            <p class="review-text">"Great space, great host, easy instructions. Everything ran smoothly — will be booking again! 10/10"</p>
            <span class="review-author">— Nunciata O., event for 40 guests</span>
        </div>

        <div class="proof-strip">
            <div class="proof-avatars">
                <div class="proof-avatar">NO</div>
                <div class="proof-avatar">AK</div>
                <div class="proof-avatar">BA</div>
            </div>
            <span class="proof-text"><strong>All five-star reviews</strong> on Peerspace</span>
        </div>
    </div>

    <!-- Step 1: What type of event? (shown after "Book an event") -->
    <div class="step" id="step1">
        <p class="step-title">What type of event?</p>
        <div class="choices choices-compact">
            <div class="choice-card" onclick="selectEventType('bridal')">
                <div class="title"><span class="event-icon bridal">◇</span> Bridal Party</div>
                <div class="desc">Hen do, bridal shower, engagement</div>
            </div>
            <div class="choice-card" onclick="selectEventType('private')">
                <div class="title"><span class="event-icon private">●</span> Private Event</div>
                <div class="desc">Birthday, baby shower, anniversary</div>
            </div>
            <div class="choice-card" onclick="selectEventType('workshop')">
                <div class="title"><span class="event-icon workshop">▣</span> Workshop</div>
                <div class="desc">Creative sessions, team activities</div>
            </div>
            <div class="choice-card" onclick="selectEventType('content')">
                <div class="title"><span class="event-icon content">◐</span> Content Creation</div>
                <div class="desc">Photography, filming, brand shoots</div>
            </div>
        </div>
        <button class="btn btn-secondary" onclick="goToStep(0)">← Back</button>
    </div>

    <!-- Step 2: Pick a month (direct grid — no this/next/later) -->
    <div class="step" id="step2">
        <p class="step-title">Pick your month</p>
        <div class="month-picker">
            <div class="month-nav">
                <button class="month-nav-btn" id="step2MonthPrevBtn" onclick="changeStep2MonthPage(-1)">←</button>
                <span class="month-display" id="step2MonthPageLabel">2026</span>
                <button class="month-nav-btn" id="step2MonthNextBtn" onclick="changeStep2MonthPage(1)">→</button>
            </div>
            <div class="month-grid" id="step2MonthGrid"></div>
        </div>
        <button class="btn btn-secondary" onclick="goToDuration()">← Back</button>
    </div>

    <!-- Step 3: Weekday or Weekend (with visual calendar) -->
    <div class="step" id="step3">
        <p class="step-title">Weekend or weekday?</p>
        <div class="day-type-picker" style="max-width:420px; margin:0 auto; display:flex; flex-direction:column; gap:14px;">

            <!-- Weekend option with calendar visual -->
            <div class="choice-card" onclick="selectDayType('weekend')" style="position:relative; overflow:hidden;">
                <div style="display:flex; align-items:center; gap:16px;">
                    <div style="flex:1;">
                        <div class="title">Weekend</div>
                        <div class="desc">Saturday & Sunday — perfect for celebrations</div>
                    </div>
                    <!-- Mini calendar wireframe -->
                    <div style="display:grid; grid-template-columns:repeat(7,1fr); gap:2px; width:112px; flex-shrink:0;">
                        <span style="font-size:0.5rem; color:var(--text-muted); text-align:center;">M</span>
                        <span style="font-size:0.5rem; color:var(--text-muted); text-align:center;">T</span>
                        <span style="font-size:0.5rem; color:var(--text-muted); text-align:center;">W</span>
                        <span style="font-size:0.5rem; color:var(--text-muted); text-align:center;">T</span>
                        <span style="font-size:0.5rem; color:var(--text-muted); text-align:center;">F</span>
                        <span style="font-size:0.5rem; color:var(--accent); text-align:center; font-weight:600;">S</span>
                        <span style="font-size:0.5rem; color:var(--accent); text-align:center; font-weight:600;">S</span>
                        <!-- Row 1 -->
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <!-- Row 2 -->
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <!-- Row 3 -->
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                    </div>
                </div>
            </div>

            <!-- Weekday option with calendar visual -->
            <div class="choice-card" onclick="selectDayType('weekday')" style="position:relative; overflow:hidden;">
                <div style="display:flex; align-items:center; gap:16px;">
                    <div style="flex:1;">
                        <div class="title">Weekday</div>
                        <div class="desc">Monday to Friday — more availability</div>
                    </div>
                    <!-- Mini calendar wireframe -->
                    <div style="display:grid; grid-template-columns:repeat(7,1fr); gap:2px; width:112px; flex-shrink:0;">
                        <span style="font-size:0.5rem; color:var(--accent); text-align:center; font-weight:600;">M</span>
                        <span style="font-size:0.5rem; color:var(--accent); text-align:center; font-weight:600;">T</span>
                        <span style="font-size:0.5rem; color:var(--accent); text-align:center; font-weight:600;">W</span>
                        <span style="font-size:0.5rem; color:var(--accent); text-align:center; font-weight:600;">T</span>
                        <span style="font-size:0.5rem; color:var(--accent); text-align:center; font-weight:600;">F</span>
                        <span style="font-size:0.5rem; color:var(--text-muted); text-align:center;">S</span>
                        <span style="font-size:0.5rem; color:var(--text-muted); text-align:center;">S</span>
                        <!-- Row 1 -->
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <!-- Row 2 -->
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <!-- Row 3 -->
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);opacity:0.8;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                        <span style="width:12px;height:12px;border-radius:3px;background:var(--border-color);opacity:0.4;"></span>
                    </div>
                </div>
            </div>

        </div>
        <button class="btn btn-secondary" onclick="goToStep(2)">← Back</button>
    </div>

    <!-- Step 3b: Which week? (shown when >6 dates) -->
    <div class="step" id="stepWeekPicker">
        <p class="step-title" id="weekPickerTitle">Which week?</p>
        <div class="choices choices-compact" id="weekPickerCards"></div>
        <button class="btn btn-secondary" onclick="goToStep(3)">← Back</button>
    </div>

    <!-- Step 4: Pick a Date -->
    <div class="step" id="step4">
        <p class="step-title" id="dateStepTitle">Pick your date</p>
        <div class="date-cards" id="dateCards"></div>
        <button class="btn btn-secondary" id="step4BackBtn" onclick="goBackFromDateStep()">← Back</button>
    </div>

    <!-- Step 4b: Select Duration (step 2 in flow: Event → Duration → Month → ...) -->
    <div class="step" id="stepDuration">
        <p class="step-title">How long do you need?</p>
        <p class="step-subtitle" id="durationRecommendation"></p>
        <div class="duration-options" style="padding-bottom: 100px;">
            <!-- Duration cards dynamically rendered based on event type -->
        </div>
        <div class="sticky-footer" id="durationFooter">
            <button class="btn-back" onclick="goToStep(1)">← Back</button>
            <button class="btn-continue" onclick="confirmDuration()">Continue</button>
        </div>
    </div>

    <!-- Step 5: Select Time -->
    <div class="step" id="step5">
        <p class="step-title">Choose your start time</p>
        <p class="step-subtitle" id="selectedDurationDisplay"></p>

        <div class="time-slots" id="timeSlotsContainer">
            <!-- Time slots will be dynamically generated based on duration -->
        </div>
        <button class="btn btn-secondary" onclick="goToStep(4)">← Back</button>
    </div>

    <!-- Step 6: Guest Count -->
    <div class="step" id="step6">
        <p class="step-title">How many guests?</p>
        <div class="guest-selector">
            <div class="guest-btn" onclick="selectGuests(this, '1-10')">
                <div class="num">1-10</div>
                <div class="label">intimate</div>
            </div>
            <div class="guest-btn" onclick="selectGuests(this, '11-20')">
                <div class="num">11-20</div>
                <div class="label">small</div>
            </div>
            <div class="guest-btn" onclick="selectGuests(this, '21-30')">
                <div class="num">21-30</div>
                <div class="label">medium</div>
            </div>
            <div class="guest-btn" onclick="selectGuests(this, '31-40')">
                <div class="num">31-40</div>
                <div class="label">max</div>
            </div>
        </div>
        <button class="btn btn-secondary" onclick="goToStep(5)">← Back</button>
    </div>

    <!-- Step 7: Your Details -->
    <div class="step" id="step7">
        <p class="step-title">Your details</p>
        <div class="form-group">
            <label class="form-label">Name</label>
            <input type="text" class="form-input" id="inputName" placeholder="Your name" autocomplete="name" oninput="validateField(this, 'name')">
            <span class="input-check" id="checkName">✓</span>
        </div>
        <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="inputEmail" placeholder="you@email.com" autocomplete="email" oninput="validateField(this, 'email')">
            <span class="input-check" id="checkEmail">✓</span>
        </div>
        <div class="form-group">
            <label class="form-label">Phone</label>
            <input type="tel" class="form-input" id="inputPhone" placeholder="07xxx xxx xxx" autocomplete="tel" inputmode="tel" oninput="validateField(this, 'phone')">
            <span class="input-check" id="checkPhone">✓</span>
        </div>

        <!-- Cloudflare Turnstile (invisible bot protection) -->
        <div id="turnstile-widget"></div>

        <button class="btn btn-primary" id="btn7" disabled onclick="submitWithTurnstile()">Review Booking</button>
        <button class="btn btn-secondary" onclick="goToStep(6)">← Back</button>
    </div>

    <!-- Step 8: Confirm & Pay -->
    <div class="step" id="step8">
        <p class="step-title" style="margin-bottom:4px;">Review Your Booking</p>
        <p style="color:var(--text-muted); font-size:0.82rem; text-align:center; margin-bottom:20px;">Check everything looks right before paying</p>

        <div class="summary">
            <div class="summary-header" style="padding-bottom:10px;">
                <div class="summary-mark">Hibiscus Studio</div>
                <div class="summary-title">Your Booking</div>
            </div>
            <div class="perforation in-summary">
                <div class="perf-circle"></div>
                <div class="perf-line"></div>
                <div class="perf-circle"></div>
            </div>
            <div class="summary-row" onclick="goToStep(1)" style="cursor:pointer;">
                <span class="summary-label">Event</span>
                <span class="summary-value" id="summaryEvent">—</span>
                <span class="summary-edit">✎</span>
            </div>
            <div class="summary-row" onclick="goToStep(4)" style="cursor:pointer;">
                <span class="summary-label">Date</span>
                <span class="summary-value" id="summaryDate">—</span>
                <span class="summary-edit">✎</span>
            </div>
            <div class="summary-row" onclick="goToStep(5)" style="cursor:pointer;">
                <span class="summary-label">Time</span>
                <span class="summary-value" id="summaryTime">—</span>
                <span class="summary-edit">✎</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">Duration</span>
                <span class="summary-value" id="summaryDuration">—</span>
            </div>
            <div class="summary-row" onclick="goToStep(6)" style="cursor:pointer;">
                <span class="summary-label">Guests</span>
                <span class="summary-value" id="summaryGuests">—</span>
                <span class="summary-edit">✎</span>
            </div>
            <div class="perforation in-summary" style="margin:0;">
                <div class="perf-circle"></div>
                <div class="perf-line"></div>
                <div class="perf-circle"></div>
            </div>
            <div class="summary-row">
                <span class="summary-label">Name</span>
                <span class="summary-value" id="summaryName">—</span>
            </div>
            <div class="summary-row" onclick="goToStep(7)" style="cursor:pointer;">
                <span class="summary-label">Email</span>
                <span class="summary-value" id="summaryEmail">—</span>
                <span class="summary-edit">✎</span>
            </div>
            <div class="summary-row" onclick="goToStep(7)" style="cursor:pointer;">
                <span class="summary-label">Phone</span>
                <span class="summary-value" id="summaryPhone">—</span>
                <span class="summary-edit">✎</span>
            </div>
        </div>

        <!-- Price breakdown -->
        <div class="deposit-info" style="margin-top:20px;">
            <div style="display:flex; justify-content:space-between; align-items:center; padding-bottom:12px; border-bottom:1px solid var(--border-color); margin-bottom:12px;">
                <span style="color:var(--text-secondary); font-size:0.82rem;" id="summaryPriceLabel">6 hours hire</span>
                <span style="color:var(--text-primary); font-size:0.95rem; font-family:var(--font-display);" id="summaryBasePrice">£465</span>
            </div>
            <div class="main">
                <span class="label">50% reservation fee</span>
                <span class="amount">£233</span>
            </div>
            <div class="note">Remaining £232 due 7 days before your event</div>
        </div>

        <!-- What's included -->
        <div class="faq">
            <div class="faq-title">What's included</div>
            <div class="amenities-grid">
                <div class="amenity-item">
                    <div class="icon">⊞</div>
                    <div class="label">40 chairs</div>
                </div>
                <div class="amenity-item">
                    <div class="icon">▭</div>
                    <div class="label">10 tables</div>
                </div>
                <div class="amenity-item">
                    <div class="icon">♪</div>
                    <div class="label">Bluetooth speaker</div>
                </div>
                <div class="amenity-item">
                    <div class="icon">⌘</div>
                    <div class="label">Wi-Fi</div>
                </div>
                <div class="amenity-item">
                    <div class="icon">◇</div>
                    <div class="label">Kitchen access</div>
                </div>
                <div class="amenity-item">
                    <div class="icon">●</div>
                    <div class="label">Private toilet</div>
                </div>
            </div>
        </div>

        <!-- Event vibe section -->
        <div class="event-vibe" id="eventVibe" style="margin-top:0;">
            <!-- Dynamically populated based on event type -->
        </div>

        <!-- Before you book (collapsible) -->
        <div class="faq" style="margin-top: 0;">
            <div class="faq-title">Before you book</div>
            <div class="faq-item">
                <div class="faq-q">What if I run over my booking time?</div>
                <div class="faq-a">You will be charged £100 for every hour (or part thereof) that you exceed your booked time.</div>
            </div>
            <div class="faq-item">
                <div class="faq-q">What if I need to cancel?</div>
                <div class="faq-a">
                    • 30+ days: Full refund of reservation fee, or free reschedule<br>
                    • 15–30 days: 50% refunded, or 1 free reschedule (confirm within 14 days)<br>
                    • 7–14 days: Non-refundable. £25 admin fee for reschedule<br>
                    • Less than 7 days: Forfeited, no reschedule<br>
                    • No-show/same-day: Full booking charged
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-q">Can I bring my own food & drinks?</div>
                <div class="faq-a">
                    Yes! Kitchenette includes fridge, 5-hob stove, microwave, double oven.
                    Outside catering welcome. No deep fat fryers.
                    We do not provide cooking utensils. Space must be left as found.
                </div>
            </div>
        </div>

        <button class="btn btn-primary" onclick="showConfirmation()" id="reviewPayBtn">Pay £150 Reservation Fee</button>
        <button class="btn btn-secondary" onclick="goToStep(7)" style="position:static; margin:12px auto 0; display:block;">← Back</button>
    </div>

    <!-- Step 9: Confirmed -->
    <div class="step" id="step9">
        <div class="confirmation">
            <div class="confirm-icon">✓</div>
            <h2 class="confirm-title">Booking Confirmed!</h2>
            <p class="confirm-text">
                We've sent a confirmation to your email.<br>
                See you at Hibiscus Studio! 💜
            </p>
            <div class="summary" style="margin-top: 24px; text-align: left;">
                <div class="summary-header">
                    <div class="summary-mark">Hibiscus Studio</div>
                    <div class="summary-title">Confirmation</div>
                </div>
                <div class="perforation in-summary">
                    <div class="perf-circle"></div>
                    <div class="perf-line"></div>
                    <div class="perf-circle"></div>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Event</span>
                    <span class="summary-value" id="receiptEvent">—</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Date</span>
                    <span class="summary-value" id="receiptDate">—</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Time</span>
                    <span class="summary-value" id="receiptTime">—</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Deposit Paid</span>
                    <span class="summary-value">£150</span>
                </div>
            </div>
        </div>
        <a href="https://www.instagram.com/hibiscusstudiosuk/" target="_blank" class="btn btn-secondary" style="position:static; display:flex; align-items:center; justify-content:center; gap:8px; text-decoration:none; margin:12px auto 0;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5"/><circle cx="12" cy="12" r="5"/><circle cx="17.5" cy="6.5" r="1.5" fill="currentColor" stroke="none"/></svg>
            Follow us on Instagram
        </a>
    </div>

    <!-- Viewing Flow -->
    <div class="step" id="stepViewing">
        <div class="viewing-info">
            <div class="icon">👀</div>
            <div class="title">Book a Viewing</div>
            <div class="desc">20 minutes · Tuesdays at 2pm</div>
        </div>
        <p class="step-title">Pick a day</p>
        <div class="date-cards" id="viewingDates"></div>
        <button class="btn btn-secondary" onclick="goToStep(0)">← Back</button>
    </div>

    <!-- Viewing Time Selection -->
    <div class="step" id="stepViewingTime">
        <p class="step-title">Choose your time</p>
        <p class="step-subtitle">20 minute viewing slot</p>
        <div class="time-slots" id="viewingTimeSlots">
            <!-- Time slots for viewings -->
        </div>
        <button class="btn btn-secondary" onclick="goToViewingStep()">← Back</button>
    </div>

    <!-- Viewing Details (Step 7 for viewings) -->
    <div class="step" id="stepViewingDetails">
        <p class="step-title">Your details</p>
        <div class="form-group">
            <label class="form-label">Name</label>
            <input type="text" class="form-input" id="viewingInputName" placeholder="Your name" autocomplete="name" oninput="validateViewingField(this, 'name')">
            <span class="input-check" id="viewingCheckName">✓</span>
        </div>
        <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="viewingInputEmail" placeholder="you@email.com" autocomplete="email" oninput="validateViewingField(this, 'email')">
            <span class="input-check" id="viewingCheckEmail">✓</span>
        </div>
        <div class="form-group">
            <label class="form-label">Phone</label>
            <input type="tel" class="form-input" id="viewingInputPhone" placeholder="07xxx xxx xxx" autocomplete="tel" inputmode="tel" oninput="validateViewingField(this, 'phone')">
            <span class="input-check" id="viewingCheckPhone">✓</span>
        </div>
        <button class="btn btn-primary" id="btnViewingConfirm" disabled onclick="goToViewingConfirm()">Confirm Viewing</button>
        <button class="btn btn-secondary" onclick="goToViewingStep()">← Back</button>
    </div>

    <!-- Viewing Confirmation -->
    <div class="step" id="stepViewingConfirm">
        <div class="viewing-info" style="background: var(--success-soft); border: 1px solid var(--success-border);">
            <div class="icon">✓</div>
            <div class="title" style="color: var(--success);">Viewing Booked</div>
            <div class="desc" style="color: var(--text-secondary);">We'll see you at Hibiscus Studio</div>
        </div>

        <div class="summary">
            <div class="summary-header">
                <div class="summary-mark">Hibiscus Studio</div>
                <div class="summary-title">Your Viewing</div>
            </div>
            <div class="perforation in-summary">
                <div class="perf-circle"></div>
                <div class="perf-line"></div>
                <div class="perf-circle"></div>
            </div>
            <div class="summary-row">
                <span class="summary-label">Date</span>
                <span class="summary-value" id="viewingSummaryDate">—</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">Time</span>
                <span class="summary-value">2:00pm (20 mins)</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">Name</span>
                <span class="summary-value" id="viewingSummaryName">—</span>
            </div>
        </div>

        <div class="faq" style="margin-top: 24px;">
            <div class="faq-title">What to expect</div>
            <div class="faq-item">
                <div class="faq-q">Where is the studio?</div>
                <div class="faq-a">We'll send the address to your email once confirmed.</div>
            </div>
            <div class="faq-item">
                <div class="faq-q">What will I see?</div>
                <div class="faq-a">Full tour of the space, amenities, and a chance to ask questions.</div>
            </div>
        </div>

        <a href="https://www.instagram.com/hibiscusstudiosuk/" target="_blank" class="btn btn-secondary" style="position:static; display:flex; align-items:center; justify-content:center; gap:8px; text-decoration:none; margin:12px auto 0;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5"/><circle cx="12" cy="12" r="5"/><circle cx="17.5" cy="6.5" r="1.5" fill="currentColor" stroke="none"/></svg>
            Follow us on Instagram
        </a>
    </div>

    <script>
        // ===== LIGHTWEIGHT TRACKING (3 events only) =====
        // Configure: Set WEBHOOK_URL to your Google Sheet webhook
        const WEBHOOK_URL = ''; // Leave empty to disable tracking
        const SESSION_ID = Date.now().toString(36) + Math.random().toString(36).substr(2, 5);

        function track(event) {
            if (!WEBHOOK_URL) return;
            const data = { event, session: SESSION_ID, ts: new Date().toISOString() };
            navigator.sendBeacon(WEBHOOK_URL, JSON.stringify(data));
        }

        // Track: page loaded
        track('booking_start');
        // ================================================

        // State (var for global access by frontend-integration.js)
        var selectedEventType = null;
        var selectedMonth = null;
        var selectedDayType = null;
        var selectedDate = null;
        var selectedDateObj = null;
        var selectedDuration = null;
        var selectedDurationPrice = 0;
        var selectedTimeStart = null;
        var selectedTimeEnd = null;
        var selectedTimeLabel = null;
        var selectedGuests = null;
        var isViewing = false;

        var eventTypeLabels = {
            'bridal': 'Bridal Party',
            'baby': 'Baby Shower',
            'birthday': 'Birthday Party',
            'private': 'Private Event',
            'corporate': 'Corporate Event',
            'workshop': 'Workshop',
            'content': 'Content Creation'
        };
        window.eventTypeLabels = eventTypeLabels;

        // Event pricing (for bridal, private, birthday, baby, corporate)
        var eventPricing = {
            4: { hours: 4, price: 345, label: '4 hours', desc: 'Flexi timing' },
            6: { hours: 6, price: 465, label: '6 hours', desc: 'Half-day' },
            8: { hours: 8, price: 645, label: '8 hours', desc: 'Flexi timing' },
            12: { hours: 12, price: 885, label: '12 hours', desc: 'Full day (10am-10pm)' }
        };

        // Workshop pricing (education-focused, lower rates)
        var workshopPricing = {
            2: { hours: 2, price: 120, label: '2 hours', desc: 'Quick session' },
            6: { hours: 6, price: 345, label: '6 hours', desc: 'Half-day workshop' },
            12: { hours: 12, price: 645, label: '12 hours', desc: 'Full-day workshop' }
        };

        // Content creation pricing (fast turnaround, lowest rates)
        var contentPricing = {
            2: { hours: 2, price: 90, label: '2 hours', desc: 'Quick shoot' },
            6: { hours: 6, price: 250, label: '6 hours', desc: 'Half-day shoot' },
            12: { hours: 12, price: 500, label: '12 hours', desc: 'Full-day shoot' }
        };

        // Get pricing tier based on event type
        function getPricingForEventType(eventType) {
            if (eventType === 'workshop') return workshopPricing;
            if (eventType === 'content') return contentPricing;
            return eventPricing; // Default for bridal, private, birthday, baby, corporate
        }

        // Recommendation engine - maps event type to recommended duration
        // Updated 2026-01-31: Owner-validated durations (voice note in brain.db)
        var durationRecommendations = {
            'bridal': 8,      // Bridal: 8 hours (6h overruns constantly)
            'baby': 6,        // Baby showers typically need 6 hours
            'birthday': 4,    // Casual birthdays can be shorter
            'private': 6,     // Intimate dinners: 6 hours (chef 2h + dining 2.5h + reset 1.5h)
            'corporate': 12,  // Corporate/bespoke: full day
            'workshop': 6,    // Workshops: 6 hours
            'content': 2      // Content creation: 2 hours
        };

        // Theme toggle function
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('hbs-theme', newTheme);
        }

        // Initialize theme from localStorage - default to light if no preference
        (function initTheme() {
            const savedTheme = localStorage.getItem('hbs-theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
            }
        })();

        // Comparison content per event type
        const eventComparisons = {
            'bridal': {
                label: 'of memories',
                examples: [
                    { thing: 'Tearful speeches', value: 'at least 2' },
                    { thing: '"Remember when..." stories', value: 'dozens' },
                    { thing: 'Group photos you\'ll frame', value: '~20' }
                ]
            },
            'private': {
                label: 'of your day',
                examples: [
                    { thing: 'Friends finally in one room', value: 'all of them' },
                    { thing: 'Songs that hit different', value: '~50' },
                    { thing: 'Cake cutting retakes', value: '~5' }
                ]
            },
            'workshop': {
                label: 'of teaching time',
                examples: [
                    { thing: 'Students you can teach', value: 'up to 20' },
                    { thing: 'Lightbulb moments to witness', value: 'several' },
                    { thing: 'Time to answer questions', value: 'plenty' }
                ]
            },
            'content': {
                label: 'of creative time',
                examples: [
                    { thing: 'Product angles captured', value: '~50' },
                    { thing: 'Lighting setups tried', value: '3-5' },
                    { thing: 'Social-ready clips', value: '~10' }
                ]
            }
        };

        function renderComparisonSections() {
            const comparison = eventComparisons[selectedEventType];
            if (!comparison) return;

            // Calculate actual event time with duration-based setup/packdown
            const totalHours = selectedDuration || 6;

            // 2-hour slots need shorter setup/pack times (20 min each)
            // Longer events keep 1h 15m for complex setups
            let setupTime, packdownTime;
            if (totalHours === 2) {
                setupTime = 0.33;   // 20 min
                packdownTime = 0.33; // 20 min
            } else {
                setupTime = 1.25;   // 1h 15m (4h, 6h, 8h, 12h events)
                packdownTime = 1.25; // 1h 15m
            }
            const eventTime = totalHours - setupTime - packdownTime;
            const eventTimeDisplay = eventTime % 1 === 0 ? eventTime : eventTime.toFixed(1);

            // Format times for display
            const formatTime = (hours) => {
                const h = Math.floor(hours);
                const m = Math.round((hours - h) * 60);
                return m > 0 ? `${h}h ${m}m` : `${h}h`;
            };

            document.querySelectorAll('.compare-section').forEach(section => {
                section.innerHTML = `
                    <div class="timeline-visual">
                        <div class="timeline-segment setup">
                            <div class="segment-icon">🎬</div>
                            <div class="segment-bar"></div>
                            <div class="segment-label">Setup</div>
                            <div class="segment-time">${formatTime(setupTime)}</div>
                        </div>
                        <div class="timeline-segment event">
                            <div class="segment-icon">🎉</div>
                            <div class="segment-bar"></div>
                            <div class="segment-label">Your Event</div>
                            <div class="segment-time">${formatTime(eventTime)}</div>
                        </div>
                        <div class="timeline-segment packdown">
                            <div class="segment-icon">🧹</div>
                            <div class="segment-bar"></div>
                            <div class="segment-label">Clear</div>
                            <div class="segment-time">${formatTime(packdownTime)}</div>
                        </div>
                    </div>
                    <div class="compare-main">${eventTimeDisplay} hours</div>
                    <div class="compare-label">${comparison.label}</div>
                    <div class="compare-examples">
                        ${comparison.examples.map(ex => `
                            <div class="compare-example">
                                <span class="thing">${ex.thing}</span>
                                <span>${ex.value}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            });
        }

        function selectEventType(type) {
            selectedEventType = type;
            window.selectedEventType = type;
            isViewing = false; // Reset viewing flag for regular events
            document.querySelectorAll('#step1 .choice-card').forEach(c => c.classList.remove('selected'));
            event.currentTarget.classList.add('selected');

            // ALL event types → Duration first (new universal flow)
            setTimeout(() => goToDuration(), 250);
        }

        // ===== DYNAMIC DATE GENERATION =====
        // Automatically generates available dates based on current date
        // No more manual updates needed each month!

        const BOOKING_LEAD_DAYS = 5; // Minimum days ahead for booking
        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const monthNamesShort = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const monthNamesFull = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

        // Generate dates for a given month, filtering out past dates and lead time
        function generateMonthDates(year, monthIndex, minDate) {
            const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();
            const weekendDates = [];
            const weekdayDates = [];

            for (let d = 1; d <= daysInMonth; d++) {
                const date = new Date(year, monthIndex, d);
                // Skip dates before minimum booking date
                if (date < minDate) continue;

                const dayOfWeek = date.getDay();
                const dateStr = `${year}-${String(monthIndex + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const dateObj = {
                    date: dateStr,
                    day: dayNames[dayOfWeek],
                    num: d,
                    month: monthNamesShort[monthIndex]
                };

                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    weekendDates.push(dateObj);
                } else {
                    weekdayDates.push(dateObj);
                }
            }

            return { weekend: weekendDates, weekday: weekdayDates };
        }

        // Calculate minimum booking date (today + lead time)
        const today = new Date();
        const minBookingDate = new Date(today);
        minBookingDate.setDate(today.getDate() + BOOKING_LEAD_DAYS);

        // Current month info
        const currentYear = today.getFullYear();
        const currentMonth = today.getMonth(); // 0-indexed
        const nextMonthIndex = (currentMonth + 1) % 12;
        const nextMonthYear = currentMonth === 11 ? currentYear + 1 : currentYear;
        const laterMonthIndex = (currentMonth + 2) % 12;
        const laterMonthYear = currentMonth >= 10 ? currentYear + 1 : currentYear;

        // Generate dates dynamically
        const datesByMonth = {
            thisMonth: generateMonthDates(currentYear, currentMonth, minBookingDate),
            nextMonth: generateMonthDates(nextMonthYear, nextMonthIndex, new Date(nextMonthYear, nextMonthIndex, 1)),
            later: generateMonthDates(laterMonthYear, laterMonthIndex, new Date(laterMonthYear, laterMonthIndex, 1))
        };

        // Update UI labels on page load (month grid initialized on demand)
        function initializeDynamicDates() {
            // No longer needed — step 2 is now a direct month grid
            // Labels are rendered dynamically in renderStep2MonthGrid()
        }

        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', initializeDynamicDates);

        // ===== STEP 2: MONTH PICKER (direct grid) =====
        var step2MonthYear = currentYear;

        function initStep2MonthGrid() {
            // Start showing from NEXT month (current month is likely over or nearly over)
            const startFromMonth = currentMonth + 1;
            const startFromYear = startFromMonth > 11 ? currentYear + 1 : currentYear;
            step2MonthYear = startFromYear;
            renderStep2MonthGrid();
        }

        function renderStep2MonthGrid() {
            const grid = document.getElementById('step2MonthGrid');
            document.getElementById('step2MonthPageLabel').textContent = step2MonthYear;
            document.getElementById('step2MonthPrevBtn').disabled = step2MonthYear <= currentYear;

            // For current year, start from next month; for future years, show all
            const startMonth = step2MonthYear === currentYear ? currentMonth + 1 : 0;

            let html = '';
            for (let i = startMonth; i < 12; i++) {
                html += `
                    <div class="month-btn" onclick="selectMonthDirect(${i}, ${step2MonthYear})">
                        <div class="month-name">${monthNamesShort[i]}</div>
                        <div class="month-year">${step2MonthYear}</div>
                    </div>
                `;
            }
            grid.innerHTML = html;
        }

        function changeStep2MonthPage(dir) {
            step2MonthYear += dir;
            renderStep2MonthGrid();
        }

        function selectMonthDirect(monthIndex, year) {
            // Generate dates for the selected month
            const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();
            const weekendDates = [];
            const weekdayDates = [];

            for (let d = 1; d <= daysInMonth; d++) {
                const date = new Date(year, monthIndex, d);
                const dayOfWeek = date.getDay();
                const dateObj = {
                    date: `${year}-${String(monthIndex + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`,
                    day: dayNames[dayOfWeek],
                    num: d,
                    month: monthNamesShort[monthIndex]
                };

                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    weekendDates.push(dateObj);
                } else {
                    weekdayDates.push(dateObj);
                }
            }

            datesByMonth.selectedDirect = { weekend: weekendDates, weekday: weekdayDates };
            selectedMonth = 'selectedDirect';

            const allDates = weekendDates.concat(weekdayDates).sort((a, b) => a.date.localeCompare(b.date));

            // Smart routing: if total dates ≤6, skip weekend/weekday step — show all dates directly
            if (allDates.length <= 6) {
                selectedDayType = 'all';
                document.getElementById('dateStepTitle').textContent = `Pick your ${monthNamesShort[monthIndex]} date`;
                renderDateCards(allDates, 'dateCards');
                goToStep(4);
                return;
            }

            // Otherwise go to weekend/weekday selection
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step3').classList.add('active');
            window.scrollTo(0, 0);
        }

        // Override goToStep(2) to init the month grid
        var originalGoToStep = null; // Will patch below

        // Track whether we came through the week picker (for back button)
        let cameFromWeekPicker = false;
        let pendingDayTypeDates = null;

        function goBackFromDateStep() {
            if (selectedDayType === 'all') {
                goToStep(2); // Skipped weekend/weekday, go to month
            } else if (cameFromWeekPicker) {
                // Go back to week picker
                document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
                document.getElementById('stepWeekPicker').classList.add('active');
                window.scrollTo(0, 0);
            } else {
                goToStep(3); // Go to weekend/weekday
            }
        }

        // Group dates by week number within their month
        function groupDatesByWeek(dates) {
            const weeks = {};
            dates.forEach(d => {
                const date = new Date(d.date);
                const dayOfMonth = date.getDate();
                const weekNum = Math.ceil(dayOfMonth / 7);
                if (!weeks[weekNum]) weeks[weekNum] = [];
                weeks[weekNum].push(d);
            });
            return weeks;
        }

        function getWeekLabel(weekNum) {
            const labels = { 1: 'First week', 2: 'Second week', 3: 'Third week', 4: 'Fourth week', 5: 'Fifth week' };
            return labels[weekNum] || `Week ${weekNum}`;
        }

        function showWeekPicker(availableDates, dayLabel, monthLabel) {
            const weeks = groupDatesByWeek(availableDates);
            const container = document.getElementById('weekPickerCards');
            document.getElementById('weekPickerTitle').textContent = `Which ${monthLabel} ${dayLabel}?`;

            container.innerHTML = Object.entries(weeks).map(([weekNum, weekDates]) => {
                const chips = weekDates.map(d =>
                    `<span style="display:inline-flex; padding:4px 10px; background:var(--bg-elevated); border:1px solid var(--border-color); border-radius:8px; font-size:0.75rem; font-weight:500; color:var(--text-secondary); white-space:nowrap;">${d.day} ${d.num}</span>`
                ).join('');
                const countLabel = weekDates.length === 1 ? '1 date' : `${weekDates.length} dates`;
                return `
                    <div class="choice-card" onclick="selectWeek(${weekNum})" style="text-align:left;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                            <div class="title" style="margin:0;">${getWeekLabel(parseInt(weekNum))}</div>
                            <span style="font-size:0.7rem; color:var(--text-muted); font-weight:500;">${countLabel} available</span>
                        </div>
                        <div style="display:flex; flex-wrap:wrap; gap:6px;">${chips}</div>
                    </div>
                `;
            }).join('');

            // Store pre-checked available dates grouped by week
            pendingDayTypeDates = { dates: availableDates, weeks };

            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('stepWeekPicker').classList.add('active');
            window.scrollTo(0, 0);
        }

        function selectWeek(weekNum) {
            const weekDates = pendingDayTypeDates.weeks[weekNum];
            // Dates already availability-checked — render directly
            renderAvailableDateCards(weekDates, 'dateCards');
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step4').classList.add('active');
            window.scrollTo(0, 0);
        }

        // Check availability for a set of dates (no rendering)
        async function checkAvailability(dates) {
            return Promise.all(
                dates.map(async d => {
                    try {
                        const response = await fetch(`https://hb-booking.nicholasfcoker.workers.dev/api/availability?date=${d.date}`);
                        const data = await response.json();
                        const hasAvailableSlot = data.slots?.some(slot => slot.available);
                        return { ...d, hasAvailableSlot };
                    } catch (err) {
                        return { ...d, hasAvailableSlot: false };
                    }
                })
            );
        }

        async function selectDayType(type) {
            selectedDayType = type;
            document.querySelectorAll('#step3 .choice-card').forEach(c => c.classList.remove('selected'));
            if (event && event.currentTarget) event.currentTarget.classList.add('selected');

            const monthData = datesByMonth[selectedMonth];
            const dates = monthData[type];
            const dayLabel = type === 'weekend' ? 'weekend' : 'weekday';
            const monthLabel = dates.length > 0 ? dates[0].month : '';

            document.getElementById('dateStepTitle').textContent = `Pick your ${monthLabel} ${dayLabel}`;

            // Show loading on step 4 while we check availability
            document.getElementById('dateCards').innerHTML = `
                <div style="grid-column:1/-1; display:flex; flex-direction:column; align-items:center; padding:3rem 1.5rem; text-align:center; min-height:200px;">
                    <div style="width:48px; height:48px; border:3px solid var(--text-secondary); border-top-color:transparent; border-radius:50%; animation:spin 1s linear infinite; margin-bottom:1.5rem; opacity:0.5;"></div>
                    <div style="font-size:1.1rem; color:var(--text-secondary);">Checking availability...</div>
                </div>`;
            goToStep(4);

            // Check availability for ALL dates, then decide routing
            const checked = await checkAvailability(dates);
            let available = checked.filter(d => d.hasAvailableSlot);

            // Fail-open: if API says ALL unavailable, calendar likely not configured — show all
            if (available.length === 0 && dates.length > 0) {
                available = dates;
            }
            if (available.length === 0) {
                renderEmptyState('dateCards', dayLabel);
                return;
            }

            // ≤6 available dates → show directly (no week picker needed)
            if (available.length <= 6) {
                cameFromWeekPicker = false;
                renderAvailableDateCards(available, 'dateCards');
                return;
            }

            // >6 available → show week picker with visual date chips
            cameFromWeekPicker = true;
            showWeekPicker(available, dayLabel, monthLabel);
        }

        // Render pre-checked available dates (no API call needed)
        function renderAvailableDateCards(availableDates, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = availableDates.map(d => `
                <div class="date-card" onclick="selectDate(this, '${d.date}', '${d.day}', ${d.num}, '${d.month}')">
                    <div class="day-name">${d.day}</div>
                    <div class="day-num">${d.num}</div>
                    <div class="month">${d.month}</div>
                </div>
            `).join('');
        }

        // Empty state — suggest next month's same day type
        function renderEmptyState(containerId, dayLabel) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div style="grid-column:1/-1; display:flex; flex-direction:column; align-items:center; padding:2rem 1.5rem; text-align:center;">
                    <div style="font-family:var(--font-display); font-style:italic; font-size:1.2rem; color:var(--text-primary); margin-bottom:8px;">
                        Fully booked
                    </div>
                    <div style="font-size:0.9rem; color:var(--text-secondary); line-height:1.5; margin-bottom:20px;">
                        No ${dayLabel} slots left this month
                    </div>
                    <button onclick="goToStep(2)" style="
                        background:var(--accent); border:none; color:#fff; padding:12px 24px;
                        border-radius:100px; font-size:0.9rem; font-weight:600; cursor:pointer;
                        font-family:var(--font-body);
                    ">Try next month →</button>
                </div>
            `;
        }

        // Direct switch from empty state — reuse selectDayType logic
        async function selectDayType_direct(type) {
            selectedDayType = type;
            const monthData = datesByMonth[selectedMonth];
            const dates = monthData[type];
            const dayLabel = type === 'weekend' ? 'weekend' : 'weekday';
            if (dates.length > 0) {
                document.getElementById('dateStepTitle').textContent = `Pick your ${dates[0].month} ${dayLabel}`;
            }
            const checked = await checkAvailability(dates);
            let available = checked.filter(d => d.hasAvailableSlot);
            if (available.length === 0 && dates.length > 0) available = dates;
            if (available.length === 0) {
                renderEmptyState('dateCards', dayLabel);
            } else {
                renderAvailableDateCards(available, 'dateCards');
            }
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step4').classList.add('active');
            window.scrollTo(0, 0);
        }

        async function renderDateCards(dates, containerId) {
            const container = document.getElementById(containerId);

            // Show loading state
            container.innerHTML = `
                <div style="
                    grid-column: 1 / -1;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    padding: 3rem 1.5rem;
                    text-align: center;
                    min-height: 300px;
                ">
                    <div style="
                        width: 48px;
                        height: 48px;
                        border: 3px solid var(--text-secondary);
                        border-top-color: transparent;
                        border-radius: 50%;
                        animation: spin 1s linear infinite;
                        margin-bottom: 1.5rem;
                        opacity: 0.5;
                    "></div>
                    <div style="
                        font-size: 1.1rem;
                        color: var(--text-secondary);
                        line-height: 1.6;
                    ">
                        Checking availability...
                    </div>
                </div>
            `;

            // Check availability for all dates in parallel
            const availabilityChecks = await Promise.all(
                dates.map(async d => {
                    try {
                        const response = await fetch(`https://hb-booking.nicholasfcoker.workers.dev/api/availability?date=${d.date}`);
                        const data = await response.json();
                        // A date is available if it has at least one available slot
                        const hasAvailableSlot = data.slots?.some(slot => slot.available);
                        return { ...d, hasAvailableSlot };
                    } catch (err) {
                        console.error(`Error checking availability for ${d.date}:`, err);
                        // If API fails, hide the date to be safe
                        return { ...d, hasAvailableSlot: false };
                    }
                })
            );

            // Only render dates with available slots (fail-open if API has no calendar data)
            let availableDates = availabilityChecks.filter(d => d.hasAvailableSlot);
            if (availableDates.length === 0 && dates.length > 0) availableDates = dates;

            if (availableDates.length === 0) {
                // Check if the OTHER day type has availability before offering it
                const altType = selectedDayType === 'weekend' ? 'weekday' : 'weekend';
                const altLabel = selectedDayType === 'weekend' ? 'weekdays' : 'weekends';
                const monthData = datesByMonth[selectedMonth];
                const altDates = monthData ? monthData[altType] : [];

                // Quick check: does the alt type even have dates?
                const altHasDates = altDates && altDates.length > 0;

                // Build recovery buttons
                let recoveryButtons = '';
                if (altHasDates) {
                    // Only offer alternative if it actually has dates to show
                    recoveryButtons = `
                        <button onclick="selectDayType_direct('${altType}')" style="
                            background: var(--bg-surface);
                            border: 1px solid var(--border-color);
                            color: var(--text-secondary);
                            padding: 10px 18px;
                            border-radius: 100px;
                            font-size: 0.85rem;
                            font-weight: 500;
                            cursor: pointer;
                            font-family: var(--font-body);
                            transition: all 0.2s;
                        ">Try ${altLabel} instead</button>
                        <button onclick="goToStep(2)" style="
                            background: var(--accent);
                            border: none;
                            color: #fff;
                            padding: 10px 18px;
                            border-radius: 100px;
                            font-size: 0.85rem;
                            font-weight: 600;
                            cursor: pointer;
                            font-family: var(--font-body);
                            transition: all 0.2s;
                        ">Pick another month</button>
                    `;
                } else {
                    // Both day types are empty — only offer month change
                    recoveryButtons = `
                        <button onclick="goToStep(2)" style="
                            background: var(--accent);
                            border: none;
                            color: #fff;
                            padding: 12px 24px;
                            border-radius: 100px;
                            font-size: 0.9rem;
                            font-weight: 600;
                            cursor: pointer;
                            font-family: var(--font-body);
                            transition: all 0.2s;
                        ">Pick another month</button>
                    `;
                }

                const emptyMsg = altHasDates
                    ? `No ${selectedDayType} slots left this month`
                    : `This month is fully booked`;

                container.innerHTML = `
                    <div style="
                        grid-column: 1 / -1;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        padding: 2rem 1.5rem;
                        text-align: center;
                    ">
                        <div style="
                            font-family: var(--font-display);
                            font-style: italic;
                            font-size: 1.2rem;
                            color: var(--text-primary);
                            margin-bottom: 8px;
                        ">
                            Fully booked
                        </div>
                        <div style="
                            font-size: 0.9rem;
                            color: var(--text-secondary);
                            line-height: 1.5;
                            margin-bottom: 20px;
                        ">
                            ${emptyMsg}
                        </div>
                        <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
                            ${recoveryButtons}
                        </div>
                    </div>
                `;
                return;
            }

            // Render only available dates
            container.innerHTML = availableDates.map(d => `
                <div class="date-card" onclick="selectDate(this, '${d.date}', '${d.day}', ${d.num}, '${d.month}')">
                    <div class="day-name">${d.day}</div>
                    <div class="day-num">${d.num}</div>
                    <div class="month">${d.month}</div>
                </div>
            `).join('');
        }

        function selectDate(el, dateStr, day, num, month) {
            selectedDate = dateStr;
            selectedDateObj = { day, num, month };
            // Explicit window assignment for integration.js access
            window.selectedDate = dateStr;
            window.selectedDateObj = { day, num, month };
            document.querySelectorAll('.date-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');

            // Auto-advance after short delay
            if (isViewing) {
                // Viewings are fixed at 2pm — skip time selection, go straight to details
                selectedTimeStart = '14:00';
                selectedTimeEnd = '14:20';
                selectedTimeLabel = '2:00pm';
                setTimeout(() => goToViewingDetails(), 250);
            } else {
                // Duration already selected — go straight to time slots (step 5)
                setTimeout(() => goToStep(5), 250);
                // Fetch live availability for the selected date + duration
                if (selectedDuration) {
                    fetchAndMarkAvailability(dateStr, selectedDuration);
                }
            }
        }

        // ===== VIEWING FLOW FUNCTIONS =====
        function goToViewingTimeSelection() {
            // Generate 20-minute viewing slots (10am-6pm, every 30 mins)
            const viewingSlots = [
                { start: '10:00', end: '10:20', label: '10:00am' },
                { start: '10:30', end: '10:50', label: '10:30am' },
                { start: '11:00', end: '11:20', label: '11:00am' },
                { start: '11:30', end: '11:50', label: '11:30am' },
                { start: '12:00', end: '12:20', label: '12:00pm' },
                { start: '12:30', end: '12:50', label: '12:30pm' },
                { start: '13:00', end: '13:20', label: '1:00pm' },
                { start: '13:30', end: '13:50', label: '1:30pm' },
                { start: '14:00', end: '14:20', label: '2:00pm' },
                { start: '14:30', end: '14:50', label: '2:30pm' },
                { start: '15:00', end: '15:20', label: '3:00pm' },
                { start: '15:30', end: '15:50', label: '3:30pm' },
                { start: '16:00', end: '16:20', label: '4:00pm' },
                { start: '16:30', end: '16:50', label: '4:30pm' },
                { start: '17:00', end: '17:20', label: '5:00pm' },
                { start: '17:30', end: '17:50', label: '5:30pm' }
            ];

            const container = document.getElementById('viewingTimeSlots');
            container.innerHTML = viewingSlots.map(slot => `
                <div class="time-slot" onclick="selectViewingTime('${slot.start}', '${slot.end}', '${slot.label}')">
                    <div class="time-slot-main">
                        <div class="time-range">
                            <span class="time">${slot.label}</span>
                        </div>
                        <span class="badge">20 mins</span>
                    </div>
                </div>
            `).join('');

            document.getElementById('progressFill').style.width = '50%'; // Step 2 of 4
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('stepViewingTime').classList.add('active');
        }

        function selectViewingTime(start, end, label) {
            selectedTimeStart = start;
            selectedTimeEnd = end;
            selectedTimeLabel = label;

            // Go to viewing details form
            setTimeout(() => goToViewingDetails(), 250);
        }

        function goToViewingDetails() {
            document.getElementById('progressFill').style.width = '66%'; // Step 2 of 3 (date → details → confirm)
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('stepViewingDetails').classList.add('active');
        }

        function goToViewingStep() {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('stepViewing').classList.add('active');
        }

        function validateViewingField(input, type) {
            const value = input.value.trim();
            let valid = false;

            if (type === 'name') valid = value.length >= 2;
            if (type === 'email') valid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
            if (type === 'phone') valid = value.replace(/\D/g, '').length >= 10;

            const checkEl = document.getElementById('viewingCheck' + type.charAt(0).toUpperCase() + type.slice(1));
            if (valid) {
                input.classList.add('valid');
                checkEl.classList.add('show');
            } else {
                input.classList.remove('valid');
                checkEl.classList.remove('show');
            }

            checkViewingFormComplete();
        }

        function checkViewingFormComplete() {
            const name = document.getElementById('viewingInputName').classList.contains('valid');
            const email = document.getElementById('viewingInputEmail').classList.contains('valid');
            const phone = document.getElementById('viewingInputPhone').classList.contains('valid');
            document.getElementById('btnViewingConfirm').disabled = !(name && email && phone);
        }

        function goToViewingConfirm() {
            // Update viewing summary
            const dateStr = `${selectedDateObj.day} ${selectedDateObj.num} ${selectedDateObj.month}`;
            document.getElementById('viewingSummaryDate').textContent = dateStr;
            document.getElementById('viewingSummaryName').textContent = document.getElementById('viewingInputName').value;

            // Track
            track('viewing_complete');

            // Show confirmation
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('stepViewingConfirm').classList.add('active');
            document.getElementById('progressBar').style.display = 'none';
        }

        // ===== DURATION PICKER FUNCTIONS =====

        // Dynamically render duration options — accordion pattern
        function renderDurationOptions(eventType) {
            const pricing = getPricingForEventType(eventType);
            const recommended = durationRecommendations[eventType] || 6;
            const eventLabel = eventTypeLabels[eventType] || 'your event';

            document.getElementById('durationRecommendation').textContent =
                `For ${eventLabel.toLowerCase()}, we recommend ${recommended} hours`;

            const filteredEntries = Object.entries(pricing)
                .filter(([hours]) => !(eventType === 'bridal' && parseInt(hours) === 4));

            // Detail hints per duration bucket
            const detailHints = {
                2: [
                    { icon: 'clock', text: 'Quick turnaround — arrive, shoot, wrap' },
                    { icon: 'plus', text: 'Best for solo creators or small setups' }
                ],
                4: [
                    { icon: 'clock', text: 'Flexible morning or afternoon block' },
                    { icon: 'plus', text: 'Good for casual, smaller gatherings' }
                ],
                6: [
                    { icon: 'clock', text: 'Morning or afternoon — you choose the start' },
                    { icon: 'plus', text: 'Comfortable pace for groups of 4 or fewer' }
                ],
                8: [
                    { icon: 'clock', text: 'Flexible start — most parties choose 9am–5pm' },
                    { icon: 'plus', text: 'Comfortable pace for full party' },
                    { icon: 'check', text: 'Includes buffer for photos & touch-ups' }
                ],
                12: [
                    { icon: 'clock', text: 'Full day from prep through evening wind-down' },
                    { icon: 'plus', text: 'Ideal for large parties with 5+ people' }
                ]
            };

            const svgIcons = {
                clock: '<svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.2"><circle cx="8" cy="8" r="6.5"/><path d="M8 4.5V8l2.5 1.5"/></svg>',
                plus: '<svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.2"><path d="M2 8h12M8 2v12"/></svg>',
                check: '<svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.2"><path d="M4 8.5l3 3 5-5.5"/></svg>'
            };

            const container = document.querySelector('.duration-options');
            container.innerHTML = filteredEntries
                .map(([hours, data]) => {
                    const h = parseInt(hours);
                    const isRecommended = h === recommended;
                    const perHour = (data.price / h).toFixed(2);
                    const hints = detailHints[h] || detailHints[6];

                    const hintRows = hints.map((hint, i) => {
                        const extra = (i === hints.length - 1) ? ` <span class="duration-per-hour">£${perHour}/hr</span>` : '';
                        return `<div class="duration-detail-row">${svgIcons[hint.icon]}<span>${hint.text}${extra}</span></div>`;
                    }).join('');

                    return `
                        <div class="duration-card ${isRecommended ? 'recommended selected' : ''}"
                             data-hours="${hours}"
                             onclick="selectDurationAccordion(this, ${hours}, ${data.price})">
                            <div class="duration-header">
                                <div class="duration-left">
                                    <div class="duration-radio"></div>
                                    <div>
                                        <div class="duration-hours">${data.label}</div>
                                        <div class="duration-sublabel">${data.desc}</div>
                                    </div>
                                </div>
                                <div class="duration-right">
                                    ${isRecommended ? '<span class="duration-badge">Recommended</span>' : ''}
                                    <span class="duration-price">£${data.price}</span>
                                </div>
                            </div>
                            <div class="duration-detail">
                                <div class="duration-detail-inner">
                                    <div class="duration-detail-content">
                                        <div class="duration-detail-divider"></div>
                                        ${hintRows}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

            // Pre-select recommended duration state
            const recData = pricing[recommended];
            if (recData) {
                selectedDuration = recommended;
                selectedDurationPrice = recData.price;
                window.selectedDuration = recommended;
                window.selectedDurationPrice = recData.price;
            }
        }

        // Accordion click — expand clicked, collapse others
        function selectDurationAccordion(el, hours, price) {
            document.querySelectorAll('.duration-card').forEach(card => card.classList.remove('selected'));
            el.classList.add('selected');
            selectedDuration = hours;
            selectedDurationPrice = price;
            window.selectedDuration = hours;
            window.selectedDurationPrice = price;
        }

        function goToDuration() {
            renderDurationOptions(selectedEventType);
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('stepDuration').classList.add('active');

            // Show stepper + minimal header
            document.getElementById('progressLabels').style.display = 'flex';
            document.getElementById('progressBar').style.display = 'block';
            document.getElementById('headerMinimal').style.display = 'block';
            document.getElementById('progressFill').style.width = '15%';

            // Update progress labels — "Event" completed
            document.querySelectorAll('#progressLabels span').forEach((el, i) => {
                el.classList.toggle('active', i <= 0);
            });

            window.scrollTo(0, 0);
        }

        // Confirm duration → advance to month selection (step 2)
        function confirmDuration() {
            if (!selectedDuration || !selectedDurationPrice) return;

            // Pre-generate time slots so they're ready later
            generateTimeSlots(selectedDuration);
            document.getElementById('selectedDurationDisplay').textContent =
                `${selectedDuration} hours`;

            goToStep(2);
        }

        // Legacy selectDuration kept for any direct calls
        function selectDuration(hours, price) {
            selectedDuration = hours;
            selectedDurationPrice = price;
            window.selectedDuration = hours;
            window.selectedDurationPrice = price;
            generateTimeSlots(hours);
            document.getElementById('selectedDurationDisplay').textContent =
                `${hours} hours · £${price}`;
            setTimeout(() => goToStep(5), 250);
            if (window.selectedDate) {
                fetchAndMarkAvailability(window.selectedDate, hours);
            }
        }

        // B1: Fetch availability from API, B2: Mark unavailable slots
        async function fetchAndMarkAvailability(date, duration) {
            const container = document.getElementById('timeSlotsContainer');
            // Show loading state
            container.querySelectorAll('.time-slot').forEach(slot => {
                slot.style.opacity = '0.5';
            });

            try {
                const response = await fetch(
                    `https://hb-booking.nicholasfcoker.workers.dev/api/availability?date=${date}&duration=${duration}`
                );
                if (!response.ok) throw new Error('Availability check failed');
                const data = await response.json();

                if (data.slots) {
                    // Build a map of start times to availability
                    const availMap = {};
                    data.slots.forEach(s => { availMap[s.start] = s.available; });

                    container.querySelectorAll('.time-slot').forEach(slotEl => {
                        const start = slotEl.dataset.start;
                        slotEl.style.opacity = '1';

                        if (start && availMap[start] === false) {
                            // Mark as unavailable
                            slotEl.classList.add('unavailable');
                            slotEl.style.opacity = '0.35';
                            slotEl.style.pointerEvents = 'none';
                            // Add booked badge
                            if (!slotEl.querySelector('.booked-label')) {
                                const badge = document.createElement('span');
                                badge.className = 'booked-label';
                                badge.textContent = 'Booked';
                                badge.style.cssText = 'position:absolute;top:10px;right:10px;background:var(--danger);color:#fff;padding:2px 8px;border-radius:6px;font-size:11px;font-weight:600;letter-spacing:0.3px;';
                                slotEl.style.position = 'relative';
                                slotEl.appendChild(badge);
                            }
                        } else {
                            // Ensure available slots are interactive
                            slotEl.classList.remove('unavailable');
                            slotEl.style.opacity = '1';
                            slotEl.style.pointerEvents = 'auto';
                            const badge = slotEl.querySelector('.booked-label');
                            if (badge) badge.remove();
                        }
                    });
                }
            } catch (err) {
                console.error('Availability fetch failed:', err);
                // On error, restore all slots to clickable (fail open)
                container.querySelectorAll('.time-slot').forEach(slot => {
                    slot.style.opacity = '1';
                });
            }
        }

        function generateTimeSlots(hours) {
            const container = document.getElementById('timeSlotsContainer');

            // Define available start times based on duration
            // Studio operates 10am-10pm (12 hours total)
            // End time must be by 10pm (22:00) unless it's a full day
            let slots = [];

            if (hours === 12) {
                // Full day - only one option: 10am-10pm
                slots = [
                    { start: '10:00', end: '22:00', label: 'Full Day', startDisplay: '10am', endDisplay: '10pm' }
                ];
            } else if (hours === 8) {
                // 8 hours - a few options
                slots = [
                    { start: '10:00', end: '18:00', label: 'Morning-Afternoon', startDisplay: '10am', endDisplay: '6pm' },
                    { start: '12:00', end: '20:00', label: 'Midday-Evening', startDisplay: '12pm', endDisplay: '8pm' },
                    { start: '14:00', end: '22:00', label: 'Afternoon-Night', startDisplay: '2pm', endDisplay: '10pm' }
                ];
            } else if (hours === 6) {
                // 6 hours (half-day) - most options
                slots = [
                    { start: '10:00', end: '16:00', label: 'Morning', startDisplay: '10am', endDisplay: '4pm' },
                    { start: '12:00', end: '18:00', label: 'Midday', startDisplay: '12pm', endDisplay: '6pm' },
                    { start: '14:00', end: '20:00', label: 'Afternoon', startDisplay: '2pm', endDisplay: '8pm' },
                    { start: '16:00', end: '22:00', label: 'Evening', startDisplay: '4pm', endDisplay: '10pm' }
                ];
            } else if (hours === 4) {
                // 4 hours - most flexible
                slots = [
                    { start: '10:00', end: '14:00', label: 'Morning', startDisplay: '10am', endDisplay: '2pm' },
                    { start: '12:00', end: '16:00', label: 'Midday', startDisplay: '12pm', endDisplay: '4pm' },
                    { start: '14:00', end: '18:00', label: 'Afternoon', startDisplay: '2pm', endDisplay: '6pm' },
                    { start: '16:00', end: '20:00', label: 'Late Afternoon', startDisplay: '4pm', endDisplay: '8pm' },
                    { start: '18:00', end: '22:00', label: 'Evening', startDisplay: '6pm', endDisplay: '10pm' }
                ];
            } else if (hours === 2) {
                // 2 hours - very flexible (content/workshop)
                slots = [
                    { start: '10:00', end: '12:00', label: 'Morning', startDisplay: '10am', endDisplay: '12pm' },
                    { start: '12:00', end: '14:00', label: 'Midday', startDisplay: '12pm', endDisplay: '2pm' },
                    { start: '14:00', end: '16:00', label: 'Early Afternoon', startDisplay: '2pm', endDisplay: '4pm' },
                    { start: '16:00', end: '18:00', label: 'Late Afternoon', startDisplay: '4pm', endDisplay: '6pm' },
                    { start: '18:00', end: '20:00', label: 'Early Evening', startDisplay: '6pm', endDisplay: '8pm' },
                    { start: '20:00', end: '22:00', label: 'Evening', startDisplay: '8pm', endDisplay: '10pm' }
                ];
            }

            // Generate HTML for time slots
            container.innerHTML = slots.map(slot => `
                <div class="time-slot" data-start="${slot.start}" onclick="expandTime(this)">
                    <div class="time-slot-main">
                        <div class="time-range">
                            <span class="time">${slot.startDisplay}</span>
                            <span class="arrow">→</span>
                            <span class="time">${slot.endDisplay}</span>
                        </div>
                        <span class="badge">${slot.label}</span>
                    </div>
                    <div class="time-breakdown">
                        <div class="compare-section"></div>
                    </div>
                    <div class="expand-hint">Tap to select</div>
                    <button class="select-time-btn" onclick="confirmTime(event, '${slot.start}', '${slot.end}', '${slot.label}')">Select this time</button>
                </div>
            `).join('');
        }

        function expandTime(el) {
            // If clicking on the button, don't toggle
            if (event.target.classList.contains('select-time-btn')) return;

            // Don't expand if slot is unavailable/booked
            if (el.classList.contains('unavailable')) return;

            // Collapse others, expand this one
            document.querySelectorAll('.time-slot').forEach(s => {
                if (s !== el) s.classList.remove('expanded');
            });
            el.classList.toggle('expanded');
        }

        function confirmTime(e, start, end, label) {
            e.stopPropagation();

            // Don't allow selecting unavailable slots
            const slot = event.target.closest('.time-slot');
            if (slot.classList.contains('unavailable')) return;

            document.querySelectorAll('.time-slot').forEach(s => {
                s.classList.remove('selected', 'expanded');
            });
            slot.classList.add('selected');

            selectedTimeStart = start;
            selectedTimeEnd = end;
            selectedTimeLabel = label;
            window.selectedTimeStart = start;
            window.selectedTimeEnd = end;
            window.selectedTimeLabel = label;

            // Now advance to guests
            setTimeout(() => goToStep(6), 200);
        }

        function selectGuests(el, count) {
            selectedGuests = count;
            window.selectedGuests = count;
            document.querySelectorAll('.guest-btn').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');

            // Auto-advance
            setTimeout(() => goToStep(7), 250);
        }

        function validateField(input, type) {
            const value = input.value.trim();
            let valid = false;

            if (type === 'name') valid = value.length >= 2;
            if (type === 'email') valid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
            if (type === 'phone') valid = value.replace(/\D/g, '').length >= 10;

            const checkEl = document.getElementById('check' + type.charAt(0).toUpperCase() + type.slice(1));
            if (valid) {
                input.classList.add('valid');
                checkEl.classList.add('show');
            } else {
                input.classList.remove('valid');
                checkEl.classList.remove('show');
            }

            checkFormComplete();
        }

        function checkFormComplete() {
            const name = document.getElementById('inputName').classList.contains('valid');
            const email = document.getElementById('inputEmail').classList.contains('valid');
            const phone = document.getElementById('inputPhone').classList.contains('valid');
            document.getElementById('btn7').disabled = !(name && email && phone);
        }

        function goToStep(step) {
            // Step 0 = welcome/intent, no stepper or progress
            const isLanding = (step === 0);
            const isEventTypes = (step === 1);
            const showStepper = !isLanding && !isEventTypes;

            // New flow: Event(1) → Duration(custom) → Month(2) → DayType(3) → Date(4) → Time(5) → Guests(6) → Details(7) → Review(8)
            // Progress mapping for the 4 stepper labels: Event | When | Time | Details
            const progressMap = {2: 30, 3: 40, 4: 50, 5: 65, 6: 75, 7: 85, 8: 100};
            if (showStepper) {
                const progress = progressMap[step] || Math.min((step / 8) * 100, 100);
                document.getElementById('progressFill').style.width = progress + '%';
            }

            // Show/hide stepper + header
            document.getElementById('progressLabels').style.display = showStepper ? 'flex' : 'none';
            document.getElementById('progressBar').style.display = showStepper ? 'block' : 'none';
            document.getElementById('headerMinimal').style.display = isLanding ? 'none' : 'block';

            // Progress label highlighting: Event(0) | When(1) | Time(2) | Details(3)
            // Steps 2-4 = "When" phase, Step 5 = "Time" phase, Steps 6-8 = "Details" phase
            const labelMap = {2: 1, 3: 1, 4: 1, 5: 2, 6: 3, 7: 3, 8: 3};
            const activeIdx = labelMap[step] || 0;
            document.querySelectorAll('#progressLabels span').forEach((el, i) => {
                el.classList.toggle('active', i <= activeIdx);
            });

            // Show/hide steps
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById(`step${step}`).classList.add('active');

            // Initialize step 2 month grid when entering step 2
            if (step === 2) {
                initStep2MonthGrid();
            }

            // Render comparison content when reaching time selection
            if (step === 5) {
                renderComparisonSections();
            }

            // Update summary on step 8
            if (step === 8) {
                updateSummary();
                track('booking_complete'); // Track: reached final step
            }

            // Scroll to top
            window.scrollTo(0, 0);
        }

        // Navigate from Step 0 → Step 1 (event type selection)
        function goToEventTypes() {
            goToStep(1);
        }

        function updateSummary() {
            const dateStr = `${selectedDateObj.day} ${selectedDateObj.num} ${selectedDateObj.month}`;
            const timeStr = `${formatTime(selectedTimeStart)} → ${formatTime(selectedTimeEnd)}`;

            document.getElementById('summaryEvent').textContent = eventTypeLabels[selectedEventType] || '—';
            document.getElementById('summaryDate').textContent = dateStr;
            document.getElementById('summaryTime').textContent = timeStr;
            document.getElementById('summaryDuration').textContent = `${selectedDuration} hours`;
            document.getElementById('summaryGuests').textContent = selectedGuests + ' guests';
            document.getElementById('summaryName').textContent = document.getElementById('inputName').value;
            document.getElementById('summaryEmail').textContent = document.getElementById('inputEmail').value;
            document.getElementById('summaryPhone').textContent = document.getElementById('inputPhone').value;

            // Price breakdown
            const basePrice = selectedDurationPrice || 465;
            document.getElementById('summaryPriceLabel').textContent = `${selectedDuration || 6} hours hire`;
            document.getElementById('summaryBasePrice').textContent = `£${basePrice}`;

            // Update deposit amount with selected duration price
            updateDepositAmount();

            // Render event vibe content
            const comparison = eventComparisons[selectedEventType];
            if (comparison) {
                document.getElementById('eventVibe').innerHTML = `
                    <div class="vibe-header">
                        <div class="vibe-time">${selectedDuration} hours</div>
                        <div class="vibe-label">${comparison.label}</div>
                    </div>
                    <div class="vibe-items">
                        ${comparison.examples.map(ex => `
                            <div class="vibe-item">
                                <span class="thing">${ex.thing}</span>
                                <span>${ex.value}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }

        function formatTime(time) {
            const [h, m] = time.split(':');
            const hour = parseInt(h);
            if (hour === 0 || hour === 24) return '12am';
            if (hour === 12) return '12pm';
            return hour > 12 ? `${hour - 12}pm` : `${hour}am`;
        }

        function showConfirmation() {
            track('cta_click'); // Track: clicked book button

            // Copy values to receipt
            document.getElementById('receiptEvent').textContent = eventTypeLabels[selectedEventType] || '—';
            document.getElementById('receiptDate').textContent = `${selectedDateObj.day} ${selectedDateObj.num} ${selectedDateObj.month} 2026`;
            document.getElementById('receiptTime').textContent = `${formatTime(selectedTimeStart)} → ${formatTime(selectedTimeEnd)} (${selectedDuration}hrs)`;

            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step9').classList.add('active');
            document.getElementById('progressBar').style.display = 'none';
        }

        async function goToViewing() {
            isViewing = true;
            // Show minimal header (we're leaving step 0)
            document.getElementById('headerMinimal').style.display = 'block';
            document.getElementById('progressFill').style.width = '33%'; // Step 1 of 3 (date → details → confirm)
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('stepViewing').classList.add('active');
            // Viewings are Tuesday only
            const allWeekdays = datesByMonth.thisMonth.weekday.concat(datesByMonth.nextMonth.weekday);
            const tuesdaysOnly = allWeekdays.filter(d => d.day === 'Tue');
            await renderDateCards(tuesdaysOnly, 'viewingDates');
        }

        // ===== MONTH PICKER (legacy removed — now handled by step2 grid) =====

        // ===== OPTIONAL EXTRAS =====
        let selectedExtras = {};
        let extrasTotal = 0;

        function toggleExtra(el, type, price) {
            el.classList.toggle('selected');
            if (selectedExtras[type]) {
                delete selectedExtras[type];
                extrasTotal -= price;
            } else {
                selectedExtras[type] = price;
                extrasTotal += price;
            }
            updateDepositAmount();
        }

        function updateDepositAmount() {
            // Use selected duration price (HOOK 4: Pricing uses selected duration)
            // Default to Half-Day (6hr = £465) if no duration selected yet
            const basePrice = selectedDurationPrice || 465;
            const total = basePrice + extrasTotal;
            const deposit = Math.ceil(total / 2);
            const remaining = total - deposit;

            document.querySelector('.deposit-info .amount').textContent = `£${deposit}`;
            document.querySelector('.deposit-info .note').textContent = `Remaining £${remaining} due 7 days before your event`;
            const payBtn = document.getElementById('reviewPayBtn');
            if (payBtn) payBtn.textContent = `Pay £${deposit} Reservation Fee`;
        }

        function startOver() {
            // Reset state
            selectedEventType = null;
            selectedMonth = null;
            selectedDayType = null;
            selectedDate = null;
            selectedDateObj = null;
            selectedDuration = null;
            selectedDurationPrice = 0;
            selectedTimeStart = null;
            selectedTimeEnd = null;
            selectedTimeLabel = null;
            selectedGuests = null;
            isViewing = false;
            selectedExtras = {};
            extrasTotal = 0;

            // Reset UI
            document.querySelectorAll('.choice-card, .date-card, .time-slot, .guest-btn, .extra-option, .duration-card').forEach(el => {
                el.classList.remove('selected', 'expanded', 'recommended');
            });
            document.querySelectorAll('.form-input').forEach(input => {
                input.value = '';
                input.classList.remove('valid');
            });
            document.querySelectorAll('.input-check').forEach(el => el.classList.remove('show'));
            document.getElementById('btn7').disabled = true;
            document.getElementById('btnViewingConfirm').disabled = true;

            // Reset deposit display (Half-Day £465 = £233 deposit)
            document.querySelector('.deposit-info .amount').textContent = '£233';
            document.querySelector('.deposit-info .note').textContent = 'Remaining £232 due 7 days before your event';
            const payBtn = document.getElementById('reviewPayBtn');
            if (payBtn) payBtn.textContent = 'Pay £233 Reservation Fee';

            // Go back to step 0 (intent selection)
            goToStep(0);
        }

        // ===== CLOUDFLARE TURNSTILE (INVISIBLE BOT PROTECTION) =====

        // Initialize Turnstile on page load
        window.addEventListener('load', function() {
            // Only initialize if turnstile is loaded
            if (typeof turnstile !== 'undefined') {
                turnstile.render('#turnstile-widget', {
                    sitekey: '0x4AAAAAACXZcRnRnZG9rA0a',
                    theme: 'light',
                    size: 'invisible',
                    callback: function(token) {
                        // Token verified, store it
                        window.turnstileToken = token;
                        console.log('Turnstile verified');
                    },
                    'error-callback': function() {
                        console.warn('Turnstile verification failed — bypassing gate');
                        window.turnstileFailed = true;
                    },
                    'expired-callback': function() {
                        console.warn('Turnstile token expired');
                        window.turnstileFailed = true;
                    }
                });
            }
        });

        // Submit with Turnstile verification
        function submitWithTurnstile() {
            if (window.turnstileToken || window.turnstileFailed) {
                // Token verified or Turnstile unavailable — proceed to review
                goToStep(8);
            } else {
                // No token yet, show alert
                alert('Please wait, verifying you\'re human...');

                // Try to execute turnstile if available
                if (typeof turnstile !== 'undefined' && turnstile.execute) {
                    turnstile.execute('#turnstile-widget');
                } else {
                // Turnstile not loaded at all — bypass
                goToStep(8);
            }
            }
        }
    </script>

    <!-- Address Footer -->
    <footer style="background: var(--bg-secondary); border-top: 1px solid var(--border-color); padding: 24px 16px; text-align: center; margin-top: 32px;">
        <p style="color: var(--text-secondary); font-size: 14px; margin: 0;">
            19a Peto Street North, London E16 1DP
        </p>
    </footer>

    <!-- Live API Integration -->
    <script src="https://hb-booking.nicholasfcoker.workers.dev/integration.js"></script>
</body>
</html>
